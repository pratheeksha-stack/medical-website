(function(g){var window=this;'use strict';var ug3=function(W){var e=new g.lx("und",new g.r9("Default","und",!0));e.captionTracks=W.captionTracks;return e},ciU=function(W){return new g.oc(function(e,l){var K=W.length,t=[];
if(K)for(var a=function(w,U){K--;t[w]=U;K==0&&e(t)},r=function(w){l(w)},b,M=0;M<W.length;M++)b=W[M],g.TWW(b,g.Wv(a,M),r);
else e(t)})},LE=function(W){this.L=W},DR=function(){LE.apply(this,arguments)},Syx=function(){DR.apply(this,arguments)},Bk2=function(){DR.apply(this,arguments)},hG2=function(){DR.apply(this,arguments)},oNK=function(){DR.apply(this,arguments)},gNx=function(){DR.apply(this,arguments)},pCp=function(){DR.apply(this,arguments)},VyU=function(){LE.apply(this,arguments)},sS2=function(){DR.apply(this,arguments)},ZAK=function(){DR.apply(this,arguments)},FZk=function(){DR.apply(this,arguments)},YyK=function(){DR.apply(this,
arguments)},OAJ=function(){DR.apply(this,arguments)},Aix=function(){DR.apply(this,arguments)},LZp=function(){DR.apply(this,arguments)},DRv=function(){DR.apply(this,arguments)},vNC=function(){DR.apply(this,arguments)},Jiv=function(){DR.apply(this,arguments)},ENt=function(){DR.apply(this,arguments)},HAC=function(){DR.apply(this,arguments)},Pcx=function(){LE.apply(this,arguments)},qyJ=function(){DR.apply(this,arguments)},frn=function(){DR.apply(this,arguments)},G1s=function(){DR.apply(this,arguments)},
Tk2=function(){DR.apply(this,arguments)},xRs=function(){DR.apply(this,arguments)},Irp=function(){DR.apply(this,arguments)},yiC=function(){DR.apply(this,arguments)},nN_=function(){DR.apply(this,arguments)},zGv=function(){DR.apply(this,arguments)},mRx=function(){LE.apply(this,arguments)},XCs=function(){LE.apply(this,arguments)},WDn=function(){LE.apply(this,arguments)},jv3=function(){DR.apply(this,arguments)},eK3=function(){DR.apply(this,arguments)},lp_=function(){DR.apply(this,arguments)},iqC=function(){DR.apply(this,
arguments)},KDk=function(){DR.apply(this,arguments)},tm3=function(){DR.apply(this,arguments)},apt=function(){DR.apply(this,arguments)},rox=function(){DR.apply(this,arguments)},k_z=function(){DR.apply(this,arguments)},bqU=function(){DR.apply(this,arguments)},$qU=function(){DR.apply(this,arguments)},Mmn=function(){DR.apply(this,arguments)},wWJ=function(){DR.apply(this,arguments)},Uqz=function(){DR.apply(this,arguments)},Coz=function(){DR.apply(this,arguments)},Qvz=function(){DR.apply(this,arguments)},
dqC=function(){DR.apply(this,arguments)},N4K=function(){DR.apply(this,arguments)},RK2=function(){DR.apply(this,arguments)},ukK=function(){DR.apply(this,arguments)},cov=function(){DR.apply(this,arguments)},SUn=function(){DR.apply(this,arguments)},B4U=function(){DR.apply(this,arguments)},hKx=function(){DR.apply(this,arguments)},ok_=function(){DR.apply(this,arguments)},gk3=function(){DR.apply(this,arguments)},pW3=function(){LE.apply(this,arguments)},VmC=function(){DR.apply(this,arguments)},sv_=function(){DR.apply(this,
arguments)},Zqs=function(){DR.apply(this,arguments)},FDp=function(){DR.apply(this,arguments)},YUJ=function(){DR.apply(this,arguments)},Oqt=function(){DR.apply(this,arguments)},AoC=function(){DR.apply(this,arguments)},LDv=function(){DR.apply(this,arguments)},Dqn=function(){DR.apply(this,arguments)},vk2=function(){DR.apply(this,arguments)},Jok=function(){DR.apply(this,arguments)},EkC=function(){DR.apply(this,arguments)},HqK=function(){DR.apply(this,arguments)},PoK=function(){DR.apply(this,arguments)},
qUt=function(){DR.apply(this,arguments)},fpz=function(){DR.apply(this,arguments)},G_x=function(){DR.apply(this,arguments)},T4_=function(){DR.apply(this,arguments)},xqz=function(){DR.apply(this,arguments)},Ipn=function(){DR.apply(this,arguments)},yoC=function(){DR.apply(this,arguments)},nkx=function(){DR.apply(this,arguments)},zKp=function(){DR.apply(this,arguments)},mq_=function(){DR.apply(this,arguments)},XWJ=function(){DR.apply(this,arguments)},Wpt=function(){DR.apply(this,arguments)},j1z=function(){DR.apply(this,
arguments)},eTK=function(){DR.apply(this,arguments)},lmU=function(){DR.apply(this,arguments)},ilz=function(){DR.apply(this,arguments)},Kpz=function(){DR.apply(this,arguments)},t5K=function(){DR.apply(this,arguments)},amx=function(W){W=W.key||W.id;
if(!W)throw Error("Entity key is missing");return W},r0_=function(){if(v5)return v5();
var W={};v5=g.jc("PersistentEntityStoreDb",{F2:(W.EntityStore={PQ:1},W.EntityAssociationStore={PQ:2},W),shared:!1,upgrade:function(e,l){l(1)&&g.DM(g.ZM(e,"EntityStore",{keyPath:"key"}),"entityType","entityType");l(2)&&(e=g.ZM(e,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.DM(e,"byParentEntityKey","parentEntityKey"),g.DM(e,"byChildEntityKey","childEntityKey"))},
version:3});return v5()},kw2=function(W){return g.Gl(r0_(),W)},blv=function(W){return g.Gl((0,g.zJp)(),W)},JT=function(W){this.token=W},ET=function(W,e){e=e===void 0?{}:e;
g.I$.call(this,g.meU[W],Object.assign({},{name:"PESEncoderError",type:W},e));this.type=W;this.level="WARNING";Object.setPrototypeOf(this,ET.prototype)},$4K=function(W){return new ET("WRONG_DATA_TYPE",{eS:W})},M5K=function(W){return W instanceof Error?new ET("UNKNOWN_ENCODE_ERROR",{pY:W.message}):new ET("UNKNOWN_ENCODE_ERROR")},wMs=function(W){return W instanceof Error?new ET("UNKNOWN_DECODE_ERROR",{pY:W.message}):new ET("UNKNOWN_DECODE_ERROR")},U4t=function(W,e){W=W instanceof ET?W:e(W);
g.Lc(W);throw W;},C2k=function(){},Q12=function(W,e,l){try{return W.X(e,l)}catch(K){U4t(K,M5K)}},d4K=function(W){W=(new TextEncoder).encode(W).subarray(0,16);
var e=new Uint8Array(16);e.set(W);return e},H5=function(W){this.L=W},RTK=function(W){var e=Nc3[W];
if(e)return e;g.DX(new g.I$("Entity model not found.",{entityType:W}))},uw3=function(W,e){this.L=W;
this.K=e;this.X={}},Sdx=function(W,e){a:{W=c0p(W.K,e.version);
try{var l=W.K(e.data,e.key);break a}catch(K){U4t(K,wMs)}l=void 0}return l},P5=function(W,e,l){return W.L.objectStore("EntityStore").get(e).then(function(K){if(K){if(l&&K.entityType!==l)throw Error("Incorrect entity type");
return Sdx(W,K)}})},qY=function(W,e,l){return l?(l=l.map(function(K){return P5(W,K,e)}),g.hQ.all(l)):W.L.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(e)).then(function(K){return K.map(function(t){return Sdx(W,t)})})},Ga=function(W,e,l){var K=amx(e),t=c0p(W.K,1),a=Object.assign({},e);
return W.L.objectStore("EntityStore").get(K).then(function(r){if(r){if(r.entityType!==l)throw Error("Incorrect entity type");a.entityMetadata||(r=Sdx(W,r),a.entityMetadata=r.entityMetadata)}}).then(function(){var r={key:K,
entityType:l,data:Q12(t,a,K),version:1};return g.hQ.all([g.OP(W.L.objectStore("EntityStore"),r),Bck(W,a,l)])}).then(function(){fE(W,K,l);
return K})},hTs=function(W,e,l){e=e.map(function(K){return Ga(W,K,l)});
return g.hQ.all(e)},Ta=function(W,e,l){if(l==null?0:l.vX){var K=new Set;
return oLn(W,e,K).then(function(){for(var a=[],r=g.u(K),b=r.next();!b.done;b=r.next())a.push(Ta(W,b.value));return g.hQ.all(a).then(function(){})})}var t=g.ny(e).entityType;
return g.hQ.all([W.L.objectStore("EntityStore").delete(e),gLv(W,e)]).then(function(){fE(W,e,t)})},pMt=function(W,e){return g.H8(W.L.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(e)},function(l){return g.hQ.all([l.delete(),
gLv(W,l.cursor.primaryKey)]).then(function(){fE(W,l.cursor.primaryKey,e);return g.JQ(l)})})},V5K=function(W,e,l,K){var t=c0p(W.K,1);
return P5(W,e,K).then(function(a){if(a){a=g.Qh(a,l);var r={key:e,entityType:K,data:Q12(t,a,e),version:1};return g.hQ.all([g.OP(W.L.objectStore("EntityStore"),r),Bck(W,a,K)])}}).then(function(){fE(W,e,K);
return e})},fE=function(W,e,l){var K=W.X[l];
K||(K=new Set,W.X[l]=K);K.add(e)},s1x=function(W,e,l){var K=amx(e);
l=RTK(l);if(!l)return g.hQ.resolve([]);l=new l(e);W=W.L.objectStore("EntityAssociationStore");e=[];l=g.u(l.K());for(var t=l.next();!t.done;t=l.next())e.push(g.OP(W,{parentEntityKey:K,childEntityKey:t.value}));return g.hQ.all(e).then(function(a){return a.map(function(r){return r[1]})})},gLv=function(W,e){return W.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(e))},Bck=function(W,e,l){var K=amx(e);
return gLv(W,K).then(function(){return s1x(W,e,l)})},oLn=function(W,e,l){if(l.has(e))return g.hQ.resolve(void 0);
l.add(e);return Zlz(W,e).then(function(K){return W.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(e)).then(function(){return K})}).then(function(K){var t=g.hQ.resolve(void 0);
K=g.u(K);for(var a=K.next(),r={};!a.done;r={Ka:void 0},a=K.next())r.Ka=a.value,t=t.then(function(b){return function(){return oLn(W,b.Ka,l)}}(r));
return t}).then(function(){})},Zlz=function(W,e){var l=W.L.objectStore("EntityAssociationStore");
return l.index("byParentEntityKey").getAll(IDBKeyRange.only(e)).then(function(K){var t=[];K=g.u(K);for(var a=K.next();!a.done;a=K.next())a=a.value,t.push(l.index("byChildEntityKey").getAll(a.childEntityKey));return g.hQ.all(t)}).then(function(K){var t=[];
K=g.u(K);for(var a=K.next();!a.done;a=K.next())a=a.value,a.length===1&&t.push(a[0].childEntityKey);return t})},xO=function(){},FpK=function(){this.L={};
this.L[0]=new xO;if(!g.u1("aes_pes_encoder_killswitch")){var W=this.L;try{var e=g.yN();var l=d4K(e);var K=new H5(new g.Sk(l),new g.cj(l))}catch(t){throw W=t instanceof Error?new ET("KEY_CREATION_FAILED",{pY:t.message}):new ET("KEY_CREATION_FAILED"),g.Lc(W),W;}W[1]=K}},c0p=function(W,e){e=e===void 0?0:e;
W=W.L[e];if(!W)throw e=new ET("INVALID_ENCODER_VERSION",{eS:e}),g.Lc(e),e;return W},Is=function(W,e){g.H.call(this);
this.token=W;this.L=e;this.observers=[];W=new g.Hf.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.yN());W.onmessage=this.K.bind(this);this.channel=W},yo=function(W,e,l){var K,t,a,r;
return g.L(function(b){if(b.L==1)return g.O(b,kw2(W.token),2);if(b.L!=3)return K=b.K,g.O(b,g.Y9(K,["EntityStore","EntityAssociationStore"],e,function(M){t=new uw3(M,W.L);return l(t)}),3);
a=b.K;t&&(r=t.X,Object.keys(r).length>0&&(W.channel.postMessage(r),Yd2(W,r)));return b.return(a)})},nE=function(W,e,l){return yo(W,{mode:"readwrite",
Gw:!0},function(K){return Ga(K,e,l)})},Ol3=function(W,e){return yo(W,{mode:"readwrite",
Gw:!0},function(l){return hTs(l,e,"offlineOrchestrationActionWrapperEntity")})},A0J=function(W,e){return yo(W,{mode:"readwrite",
Gw:!0},function(l){return Ta(l,e)})},LpJ=function(W){return yo(W,{mode:"readwrite",
Gw:!0},function(e){return pMt(e,"videoPlaybackPositionEntity")})},za=function(W,e,l){return yo(W,{mode:"readonly",
Gw:!0},function(K){return P5(K,e,l)})},mC=function(W,e,l){return yo(W,{mode:"readonly",
Gw:!0},function(K){return qY(K,e,l)})},Yd2=function(W,e){W=g.u(W.observers);
for(var l=W.next();!l.done;l=W.next())l=l.value,l(e)},D4z=function(){var W,e,l;
return g.L(function(K){if(K.L==1)return g.cf(K,2),g.O(K,g.XY(),4);if(K.L!=2){W=K.K;if(!W||!g.n_()||typeof g.Hf.BroadcastChannel==="undefined")return K.return();e=new FpK;return K.return(new Is(W,e))}l=g.oG(K);l instanceof Error&&g.Lc(l);return K.return()})},Xm=function(){vLs||(vLs=D4z());
return vLs},J0n=function(W){var e;
W=(e=W.options)==null?void 0:e.persistenceOption;return W==="ENTITY_PERSISTENCE_OPTION_PERSIST"||W==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},ELK=function(W){var e;
return g.L(function(l){return l.L==1?g.O(l,Xm(),2):(e=l.K)?g.O(l,yo(e,"readwrite",function(K){for(var t={},a=g.u(W),r=a.next(),b={};!r.done;b={Lv:void 0,O_:void 0},r=a.next())b.Lv=r.value,b.Lv.entityKey&&J0n(b.Lv)&&(b.O_=g.Z0(b.Lv.payload),r=void 0,b.Lv.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(r=function(M){return function(){return Ga(K,M.Lv.payload[M.O_],M.O_)}}(b)),b.Lv.type==="ENTITY_MUTATION_TYPE_DELETE"&&(r=function(M){return function(){return Ta(K,M.Lv.entityKey)}}(b)),b.Lv.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(r=function(M){return function(){return V5K(K,M.Lv.entityKey,M.Lv.payload[M.O_],M.O_)}}(b)),r&&(t[b.Lv.entityKey]=t[b.Lv.entityKey]?t[b.Lv.entityKey].then(r):r()));
return g.hQ.all(Object.values(t))}),0):l.return()})},Hln=function(W){var e;
return g.L(function(l){if(l.L==1){e=W.mutations;if(!e||e.length<=0)return l.return();if(g.js){var K={type:"ENTITY_LOADED"};e!==void 0&&(K.payload=e);g.js.dispatch(K)}return g.O(l,ELK(e),2)}e.length=0;g.uC(l)})},P2C=function(W){return W!==void 0},qdn=function(W){var e=g.Vc();
e=Object.assign({},e);W=Object.assign({},W);for(var l in e)W[l]?(e[l]!==4&&(e[l]=W[l]),delete W[l]):e[l]!==2&&(e[l]=4);Object.assign(e,W);g.WeL(e);JSON.stringify(e);return e},fmt=function(W){var e,l;
return g.L(function(K){if(K.L==1)return g.O(K,g.XY(),2);if(K.L!=3)return(e=K.K)?g.O(K,g.FS(e),3):K.return();l=K.K;return K.return(g.Y9(l,["index","media","captions"],{mode:"readwrite",Gw:!0},function(t){var a=IDBKeyRange.bound(W+"|",W+"~");t=[t.objectStore("index").delete(a),t.objectStore("media").delete(a),t.objectStore("captions").delete(a)];return g.hQ.all(t).then(function(){})}))})},GwU=function(){var W,e;
return g.L(function(l){if(l.L==1)return g.O(l,g.XY(),2);if(l.L!=3){W=l.K;if(!W)throw g.SW("rvdfd");return g.O(l,g.FS(W),3)}e=l.K;return l.return(g.Y9(e,["index","media"],{mode:"readwrite",Gw:!0},function(K){var t={};return g.v8(K.objectStore("index"),{},function(a){var r=a.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),b=g.hQ.resolve(void 0);if(r){var M=r[1];r=r[2];t[M]=t[M]||{};var w;t[M][r]=g.KeG((w=a.getValue())==null?void 0:w.fmts)}else b=a.delete().then(function(){});
return g.hQ.all([g.JQ(a),b]).then(function(U){return g.u(U).next().value})}).then(function(){for(var a={},r=g.u(Object.keys(t)),b=r.next();!b.done;b=r.next()){b=b.value;
var M=t[b].v;a[b]=t[b].a&&M?1:2}var w=qdn(a);return g.puV(K.objectStore("media"),{},function(U){var C=U.cursor.key.match(g.kvt);C&&a[C[1]]||K.objectStore("media").delete(U.cursor.key);return g.NwV(U)}).then(function(){return w})})}))})},Tcz=function(W,e){var l,K;
return g.L(function(t){if(t.L==1)return g.O(t,g.XY(),2);if(t.L!=3){l=t.K;if(!l)throw g.SW("wct");return g.O(t,g.FS(l),3)}K=t.K;return g.O(t,g.Y9(K,["captions"],{mode:"readwrite",Gw:!0},function(a){var r=[];a=a.objectStore("captions");for(var b=0;b<e.length;b++){var M=g.OP(a,e[b],W+"|"+e[b].metadata.vss_id);r.push(M)}return g.hQ.all(r)}),0)})},x4J=function(W){var e,l,K;
return g.L(function(t){if(t.L==1)return e=IDBKeyRange.bound(W+"|",W+"~"),g.O(t,g.XY(),2);if(t.L!=3){l=t.K;if(!l)throw g.SW("gactfv");return g.O(t,g.FS(l),3)}K=t.K;return t.return(K.getAll("captions",e))})},ImK=function(W){return g.L(function(e){g.ZK(W,0);
return e.return(fmt(W))})},y0K=function(W){return{context:g.zn(),
videoIds:W}},nLz=function(W){return{context:g.zn(),
playlistIds:W}},zTJ=function(W){return{context:g.zn(),
offlinePlaylistSyncChecks:W}},m4v=function(){this.L=new Map},Wzp=function(){XMz||(XMz=new m4v);
return XMz},jRv=function(W,e){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:W},metadata:e,statusCode:void 0,csn:void 0,can:void 0}},eu_=function(W,e,l){if(!l){var K=K===void 0?!1:K;
l=W.L.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!l||K)l=g.h2(16),W.L.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",l)}W={flowNonce:l,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:e.eventType};e.metadata&&(W.flowMetadata=e.metadata);e.statusCode!==void 0&&(W.flowEventStatus=e.statusCode);e.csn&&(W.csn=e.csn);e.can&&(W.can=e.can);g.bL("flowEvent",W,void 0)},lO3=function(W){var e,l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU,rx,NK,p,Z,F;
return g.L(function(D){if(D.L==1)return g.O(D,yo(W,{mode:"readonly",Gw:!0},function(J){return qY(J,"playbackData").then(function(jl){var KH=jl.map(function(rQ){return rQ.transfer}).filter(function(rQ){return!!rQ}),tm=jl.map(function(rQ){return rQ.offlineVideoPolicy}).filter(function(rQ){return!!rQ}),E=jl.filter(function(rQ){return!!rQ.key}).map(function(rQ){return g.zo(g.ny(rQ.key).entityId,"downloadStatusEntity")});
KH=qY(J,"transfer",KH);tm=qY(J,"offlineVideoPolicy",tm);E=qY(J,"downloadStatusEntity",E);var Sl=KH.then(function(rQ){rQ=rQ.reduce(function(kW,OJ){(OJ==null?0:OJ.offlineVideoStreams)&&kW.push.apply(kW,g.B(OJ.offlineVideoStreams));return kW},[]).filter(function(kW){return!!kW});
return qY(J,"offlineVideoStreams",rQ)});
return g.hQ.all([KH,tm,Sl,E]).then(function(rQ){var kW=g.u(rQ);rQ=kW.next().value;var OJ=kW.next().value;var zE=kW.next().value;kW=kW.next().value;return[jl,rQ,OJ,zE,kW]})})}),2);
if(D.L!=3)return e=D.K,g.O(D,yo(W,{mode:"readonly",Gw:!0},function(J){return qY(J,"mainDownloadsListEntity").then(function(jl){var KH,tm;return(tm=(KH=jl[0])==null?void 0:KH.downloads)!=null?tm:[]})}),3);
l=D.K;K=g.u(e);t=K.next().value;a=K.next().value;r=K.next().value;b=K.next().value;M=K.next().value;w=t;U=a;C=r;Q=b;d=M;N={};S={};h={};V={};Y={};A=[];v=g.u(U);for(q=v.next();!q.done;q=v.next())(X=q.value)&&(N[X.key]=X);y=g.u(C);for(iC=y.next();!iC.done;iC=y.next())(aG=iC.value)&&(S[aG.key]=aG);Wf=g.u(d);for(G=Wf.next();!G.done;G=Wf.next())(m=G.value)&&(h[m.key]=m);c=g.u(Q);for(T=c.next();!T.done;T=c.next())(Pf=T.value)&&(V[Pf.key]=Pf);on=g.u(l);for(dx=on.next();!dx.done;dx=on.next())pH=dx.value,jU=
void 0,Y[(jU=pH.videoItem)!=null?jU:""]=!0,pH.videoItem&&(NK=rx=void 0,p=(NK=(rx=g.ny(pH.videoItem))==null?void 0:rx.entityId)!=null?NK:"",A.push({externalVideoId:p}));Z=w.filter(function(J){if(!J||!J.key||!J.offlineVideoPolicy)return!1;J=g.ny(J.key).entityId;J=g.zo(J,"downloadStatusEntity");var jl;return!(J&&((jl=h[J])==null?void 0:jl.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
F=Z.map(function(J){var jl=N[J.transfer],KH=[];if(jl==null?0:jl.offlineVideoStreams)for(var tm=g.u(jl.offlineVideoStreams),E=tm.next();!E.done;E=tm.next())(E=V[E.value])&&KH.push(E);tm=S[J.offlineVideoPolicy];E=Y;var Sl=J==null?void 0:J.playerResponseTimestamp,rQ=g.ny(tm.key).entityId;J=g.zo(rQ,"mainVideoEntity");if(tm.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var kW="OFFLINE_VIDEO_STATE_DISABLED";tm.expirationTimestamp&&Number(tm.expirationTimestamp)<Date.now()/1E3&&(kW="OFFLINE_VIDEO_STATE_EXPIRED")}else if(tm.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")kW="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(jl==null?void 0:jl.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":kW="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":kW="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":kW="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":kW="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":kW="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":kW="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:kW="OFFLINE_VIDEO_STATE_UNKNOWN"}if(kW==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(jl==null?void 0:jl.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":kW="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":kW="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":kW=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}rQ={id:rQ,videoState:kW};if(jl==null?0:jl.cotn)rQ.cotn=jl.cotn;if(jl==null?0:jl.maximumDownloadQuality)rQ.selectedVideoQuality=jl==null?void 0:jl.maximumDownloadQuality;if(jl==null?0:jl.lastProgressTimeMs)rQ.lastProgressTimeMs=jl.lastProgressTimeMs;Sl&&(rQ.playerResponseSavedTimeMs=String(Number(Sl)*1E3));jl=String;Sl=0;KH=g.u(KH);for(kW=KH.next();!kW.done;kW=KH.next())if(kW=kW.value,kW.streamsProgress){kW=g.u(kW.streamsProgress);for(var OJ=kW.next();!OJ.done;OJ=
kW.next()){var zE=void 0;Sl+=Number((zE=OJ.value.numBytesDownloaded)!=null?zE:0)}}rQ.downloadedBytes=jl(Sl);rQ.selectedOfflineMode=E[J]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";tm.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(rQ.offlinePlaybackDisabledReason=tm.offlinePlaybackDisabledReason);return rQ});
return D.return({offlineVideos:F,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:A}}})})},iPs=function(){this.locks=navigator.locks},Kzn=function(){try{var W=g.fH("ytglobal.locks_");
if(W)return W;var e;if(e=navigator){var l=navigator;e="locks"in l&&!!l.locks}if(e)return g.Hf.localStorage&&g.Hf.localStorage.getItem("noop"),W=new iPs,g.qs("ytglobal.locks_",W),W}catch(K){}},W3=function(){},tD3=function(){},aOk=function(W){if(W.includes(":"))throw Error("Invalid user cache name: "+W);
return W+":"+g.yN("CacheStorage get")},rft=function(){return g.L(function(W){if(jr!==void 0)return W.return(jr);
jr=new Promise(function(e){var l;return g.L(function(K){switch(K.L){case 1:return g.cf(K,2),g.O(K,er.open("test-only"),4);case 4:return g.O(K,er.delete("test-only"),5);case 5:g.hm(K,3);break;case 2:if(l=g.oG(K),l instanceof Error&&l.name==="SecurityError")return e(!1),K.return();case 3:e("caches"in window),g.uC(K)}})});
return W.return(jr)})},bPs=function(){return g.L(function(W){if(W.L==1)return g.O(W,rft(),2);
if(!W.K)return W.return(void 0);k8K||(k8K=new tD3);return W.return(k8K)})},lQ=function(W,e,l){g.DX(new g.I$("Woffle: "+W,l?{cotn:l}:""));
e instanceof Error&&g.DX(e)},$lJ=function(W){var e;
return g.L(function(l){if(l.L==1)return g.O(l,lO3(W),2);e=l.K;g.bL("offlineStateSnapshot",e);g.uC(l)})},iQ=function(W){g.H.call(this);
var e=this;this.api=W;this.Xi={aHV:function(){return e.L},
i7r:function(){return e.K}};
typeof g.Hf.BroadcastChannel!=="undefined"&&(this.L=new g.Hf.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.yN()),this.L.onmessage=this.X.bind(this),this.K=new g.Hf.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.yN()),this.K.onmessage=this.J.bind(this))},Kd=function(W,e){W.api.hS("onOfflineOperationFailure",e);
var l;(l=W.L)==null||l.postMessage(e)},MDJ=function(W,e,l,K){var t=this;
this.N=W;this.T=e;this.visibility=l;this.W=K;this.C=this.B=this.V=this.X=this.L=!1;this.J=new g.IP(function(){t.Sa()});
this.Xi={yW:function(){return t.K},
Sa:function(){t.Sa()},
qPg:function(){return t.J}};
this.visibility.subscribe("visibilitystatechange",function(){t.uy()})},w0p=function(W){if(!W.X&&!W.L){var e=Kzn();
if(e){W.X=!0;var l=g.yN("OfflineLockManager");e.request("woffle_orchestration_leader:"+l,{},function(){var K,t,a,r;return g.L(function(b){switch(b.L){case 1:return g.cf(b,2),W.K=new g.gr,W.L=!0,W.X=!1,g.O(b,W.N(),4);case 4:return g.O(b,W.K.promise,5);case 5:g.hm(b,0);break;case 2:K=g.oG(b),((a=(t=W).W)==null?0:a.call(t,"wo_relinquish_leadership_on_lock_request_error"))||W.Sa(),K instanceof Error&&(r=K,r.args=[{name:"WoLockManagerError",kM:K.name}],g.Lc(r)),g.uC(b)}})})}}},Uln=function(W){W.L&&(W.C=
!0,t_(W))},CP2=function(W,e){W.L&&(W.V=e,t_(W))},QR3=function(W,e){W.L&&(W.B=e,t_(W))},t_=function(W){W.B&&W.V&&W.C&&W.visibility.isBackground()?g.yj(W.J,6E4):W.J.stop()},aI=function(W){var e;
W.offlineDeleteReason=(e=W.offlineDeleteReason)!=null?e:"OFFLINE_DELETE_REASON_UNKNOWN";var l;W.offlineModeType=(l=W.offlineModeType)!=null?l:"OFFLINE_NOW";g.bL("offlineDeleteEvent",W)},rL=function(W,e){var l=e.videoId;
var K=e.le;e=e.offlineModeType;W.encryptedVideoId=l;W.cotn=K==null?void 0:K.cotn;W.offlineabilityFormatType=K==null?void 0:K.maximumDownloadQuality;var t;W.isRefresh=(t=K==null?void 0:K.isRefresh)!=null?t:!1;var a;W.softErrorCount=(a=K==null?void 0:K.transferRetryCount)!=null?a:0;W.offlineModeType=e!=null?e:"OFFLINE_NOW";(W.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&W.statusType==="UNKNOWN_STATUS_TYPE"||!W.transferStatusType&&!W.statusType)&&g.DX(Error("Woffle unknown transfer status"));
g.bL("offlineTransferStatusChanged",W)},dlv=function(W,e,l,K){K={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!K};e&&l&&(e=Math.floor(e/1024).toFixed(),l=Math.floor(l/1024).toFixed(),K.alreadyDownloadedKbytes=e,K.totalFetchedKbytes=e,K.totalContentKbytes=l);rL(K,W)},NCC=function(W){rL({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},W)},RuC=function(W){switch(W){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
k4=function(W){var e,l,K;
return((K=(e=W.actionMetadata)==null?void 0:(l=e.retryScheduleIntervalsInSeconds)==null?void 0:l.length)!=null?K:0)>0},bQ=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!W.entityKey},$4=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!W.entityKey},Mm=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!W.entityKey},ucn=function(W){return W.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!W.entityKey},
wL=function(W,e,l,K,t){t=t===void 0?!1:t;
var a,r,b,M,w,U;return g.L(function(C){if(C.L==1)return a=g.zo(W,e),r=g.zo(W,"downloadStatusEntity"),g.O(C,yo(l,{mode:"readonly",Gw:!0},function(Q){return g.hQ.all([P5(Q,a,e),P5(Q,r,"downloadStatusEntity")])}),2);
b=C.K;M=b.length?b[0]:void 0;if(!M)return C.lq(0);w=cfn;if(U=b.length>1?b[1]:void 0){if(U.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!t)return C.return();U.downloadState=K}else U={key:r,downloadState:K};g.PR(M,w,U);return g.O(C,yo(l,{mode:"readwrite",Gw:!0},function(Q){return g.hQ.all([Ga(Q,M,e),Ga(Q,U,"downloadStatusEntity")])}),0)})},Uw=function(W,e){return W.actionType===e.actionType&&W.entityKey===e.entityKey},Cd=function(W,e){if(W&&W.transferState!=="TRANSFER_STATE_COMPLETE"&&W.transferState!==
"TRANSFER_STATE_FAILED"){var l=g.ny(W.key).entityId;
rL({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:l,le:W,offlineModeType:e})}},Qq=function(W){if(!W||!W.thumbnails)return[];
var e=[];W=g.u(W.thumbnails);for(var l=W.next();!l.done;l=W.next())l=l.value,l.url&&e.push(l.url);return e},SQ3=function(W,e,l){l=l===void 0?[]:l;
var K,t,a,r,b,M,w,U,C,Q,d,N,S;return g.L(function(h){if(h.L==1)return l.length?g.O(h,mC(W,e),2):h.return([]);K=h.K;t=new Set;a=g.u(K);for(r=a.next();!r.done;r=a.next())if(b=r.value,M=b.id||b.key)w=g.ny(M).entityId,t.add(w);U=[];C=g.u(l);for(Q=C.next();!Q.done;Q=C.next())d=Q.value,N=d.offlineVideoData,S=void 0,((S=N)==null?0:S.videoId)&&!t.has(N.videoId)&&U.push(d);return h.return(U)})},BCk=function(W,e,l){return new g.fT(W,{cotn:e,
raw_player_response:l,download_media:!0,start:Infinity,disable_watch_next:!0})},hu2=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},dL=function(W,e,l,K,t,a,r,b,M,w,U){this.entityType=W;
this.actionId=e;this.action=l;this.parentActionId=K;this.rootActionId=t===void 0?e:t;this.childActionIds=a;this.prereqActionId=r;this.postreqActionIds=b;this.hasChildActionFailed=w;this.retryScheduleIndex=0;this.L=U||Date.now();this.retryScheduleIndex=M||0},Nm=function(W){if(!W.key)throw Error("Entity key is required.");
if(!W.actionProto)throw Error("OfflineOrchestrationAction is required.");var e=g.ny(W.key),l=g.ny(W.actionProto.entityKey);return new dL(l.entityType,e.entityId,W.actionProto,W.parentActionId,W.rootActionId,W.childActionIds,W.prereqActionId,W.postreqActionIds,W.retryScheduleIndex,W.hasChildActionFailed,Number(W.enqueueTimeSec)*1E3)},RI=function(W){return{key:g.zo(W.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:W.action,parentActionId:W.parentActionId,rootActionId:W.rootActionId,childActionIds:W.childActionIds,prereqActionId:W.prereqActionId,postreqActionIds:W.postreqActionIds,retryScheduleIndex:W.retryScheduleIndex,hasChildActionFailed:W.hasChildActionFailed,enqueueTimeSec:(W.L/1E3).toFixed()}},o3p=function(){var W;
return g.L(function(e){return e.L==1?g.O(e,bPs(),2):(W=e.K)?e.return(W.delete("yt-player-local-img")):e.return(!0)})},uQ=function(W){var e,l;
return g.L(function(K){if(K.L==1)return g.O(K,bPs(),2);if(K.L!=3){e=K.K;if(!e)throw Error("Cache API not supported");return W.length?g.O(K,e.open("yt-player-local-img"),3):K.return()}l=K.K;return g.O(K,Promise.all(W.map(function(t){return l.delete(t)})),0)})},c3=function(W){var e,l;
return g.L(function(K){if(K.L==1)return g.O(K,bPs(),2);if(K.L!=3){e=K.K;if(!e)throw Error("Cache API not supported");return W.length?g.O(K,e.open("yt-player-local-img"),3):K.return()}l=K.K;return g.O(K,l.addAll(W),0)})},Sr=function(W,e,l,K,t){var a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU;
return g.L(function(rx){switch(rx.L){case 1:return a=g.zo(W,"mainVideoEntity"),r=g.zo(W,"ytMainChannelEntity"),b=g.zo(W,"transfer"),M=g.zo(W,"videoDownloadContextEntity"),g.O(rx,yo(e,{mode:"readonly",Gw:!0},function(NK){return g.hQ.all([P5(NK,a,"mainVideoEntity"),P5(NK,r,"ytMainChannelEntity"),P5(NK,b,"transfer"),P5(NK,M,"videoDownloadContextEntity"),qY(NK,"ytMainChannelEntity"),qY(NK,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:w=rx.K;U=g.u(w);C=U.next().value;Q=U.next().value;d=U.next().value;N=U.next().value;S=U.next().value;h=U.next().value;V=C;Y=Q;A=d;v=N;q=S;X=h;if(!V&&!Y){rx.lq(3);break}y=V?Qq(V.thumbnail):[];if(!Y){iC=[];rx.lq(4);break}return g.O(rx,g3U(Y,q),5);case 5:iC=rx.K;case 4:return aG=iC,g.O(rx,uQ(y.concat(aG)),3);case 3:Wf=[];G=g.zo(W,"downloadStatusEntity");m=g.u(X);for(c=m.next();!c.done;c=m.next())T=c.value,Pf=g.ny(T.key).entityId,on=Nm(T),dx=g.ny(on.action.entityKey).entityId,Pf!==W&&dx!==W||Uw(l,
T.actionProto)||Wf.push(T.key);return g.O(rx,yo(e,{mode:"readwrite",Gw:!0},function(NK){var p=Wf.map(function(Z){return Ta(NK,Z)});
p.push(Ta(NK,a,{vX:!0}));p.push(Ta(NK,G,{vX:!0}));return g.hQ.all(p)}),7);
case 7:jU=(pH=v)==null?void 0:pH.offlineModeType,t&&(aI(t),t.offlineModeType&&(jU=t.offlineModeType)),Cd(A,jU),Kd(K,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.uC(rx)}})},sRU=function(W,e,l,K){var t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU,rx,NK,p,Z,F,D,J,jl,KH,tm,E,Sl,rQ,kW,OJ,zE,Hv,ms;
return g.L(function(xW){switch(xW.L){case 1:return t=g.zo(W,"mainPlaylistEntity"),a=g.zo(W,"ytMainChannelEntity"),g.O(xW,yo(e,{mode:"readonly",Gw:!0},function(IU){return g.hQ.all([P5(IU,t,"mainPlaylistEntity"),P5(IU,a,"ytMainChannelEntity"),qY(IU,"mainPlaylistEntity"),qY(IU,"mainDownloadsListEntity"),qY(IU,"ytMainChannelEntity"),qY(IU,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:r=xW.K;b=g.u(r);M=b.next().value;w=b.next().value;U=b.next().value;C=b.next().value;Q=b.next().value;d=b.next().value;N=M;S=w;h=U;V=C;Y=Q;A=d;if(!N&&!S){xW.lq(3);break}v=N?p0p(N):[];if(!S){q=[];xW.lq(4);break}return g.O(xW,g3U(S,Y),5);case 5:q=xW.K;case 4:return X=q,g.O(xW,uQ(v.concat(X)),3);case 3:y=[];iC=new Map;if(!N){xW.lq(7);break}return g.O(xW,VD3(N,h,V),8);case 8:y=xW.K;aG=g.u(y);for(Wf=aG.next();!Wf.done;Wf=aG.next())G=Wf.value,iC.set(G,{videoId:G,playlistId:W,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.O(xW,yo(e,{mode:"readonly",Gw:!0},function(IU){return g.hQ.all([qY(IU,"transfer"),qY(IU,"videoDownloadContextEntity")])}),9);
case 9:m=xW.K;c=g.u(m);T=c.next().value;Pf=c.next().value;on=T;dx=Pf;pH=g.u(on);for(jU=pH.next();!jU.done;jU=pH.next())rx=jU.value,NK=g.ny(rx.key).entityId,(p=iC.get(NK))&&rx&&(p.cotn=rx.cotn);Z=g.u(dx);for(F=Z.next();!F.done;F=Z.next())D=F.value,J=g.ny(D.key).entityId,(jl=iC.get(J))&&D&&(jl.offlineModeType=D.offlineModeType);case 7:KH=[];tm=g.u(A);for(E=tm.next();!E.done;E=tm.next())Sl=E.value,rQ=g.ny(Sl.key).entityId,kW=Nm(Sl),rQ!==W&&kW.rootActionId!==W||Uw(l,Sl.actionProto)||KH.push(Sl.key);OJ=
g.zo(W,"mainPlaylistEntity");return g.O(xW,yo(e,{mode:"readwrite",Gw:!0},function(IU){var Py=KH.map(function(dM){return Ta(IU,dM)});
Py.push(Ta(IU,OJ,{vX:!0}));return g.hQ.all(Py)}),10);
case 10:if(!N){xW.lq(0);break}y.reverse();if(!y){xW.lq(0);break}zE=g.u(y);Hv=zE.next();case 13:if(Hv.done){xW.lq(0);break}ms=Hv.value;return g.O(xW,Sr(ms,e,l,K,iC.get(ms)),14);case 14:Hv=zE.next(),xW.lq(13)}})},Fzx=function(W,e,l,K){var t,a,r,b,M,w,U,C,Q;
return g.L(function(d){if(d.L==1)return t=g.zo("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),a=new Map,g.O(d,yo(W,{mode:"readwrite",Gw:!0},function(N){var S=qY(N,"transfer"),h=qY(N,"offlineOrchestrationActionWrapperEntity"),V=qY(N,"videoDownloadContextEntity"),Y=P5(N,t,"mainDownloadsListEntity");return g.hQ.all([S,h,V,Y]).then(function(A){A=g.u(A);var v=A.next().value;var q=A.next().value;var X=A.next().value;var y=A.next().value;A=ZPJ.map(function(aG){return pMt(N,aG)});
q=g.u(q);for(var iC=q.next();!iC.done;iC=q.next())iC=iC.value,Uw(e,iC.actionProto)||A.push(Ta(N,iC.key,{vX:!0}));y&&(y.downloads=[],A.push(Ga(N,y,"mainDownloadsListEntity")));if(X)for(X=g.u(X),y=X.next();!y.done;y=X.next())y=y.value,q=g.ny(y.key).entityId,q=g.zo(q,"transfer"),a.set(q,y.offlineModeType);return g.hQ.all(A).then(function(){return v})})}),2);
r=d.K;b=g.u(r);for(M=b.next();!M.done;M=b.next())w=M.value,Cd(w,a.get(w.key)),U=g.ny(w.key).entityId,C={videoId:U,offlineDeleteReason:K,cotn:w.cotn,offlineModeType:a.get(w.key)},aI(C),Q=g.zo(U,"mainVideoEntity"),Kd(l,{entityKey:Q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.O(d,o3p(),0)})},p0p=function(W,e){var l=[];
if(W.thumbnailStyleData){W=g.u(W.thumbnailStyleData);for(var K=W.next();!K.done;K=W.next()){var t=void 0,a=void 0,r=void 0;l=l.concat(Qq((t=K.value)==null?void 0:(a=t.value)==null?void 0:(r=a.collageThumbnail)==null?void 0:r.coverThumbnail))}}e=Qq(e);return l.concat(e)},VD3=function(W,e,l){var K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG;
return g.L(function(Wf){K=[];t=new Set;if(l.length)for(a=g.u(l),r=a.next();!r.done;r=a.next())if(b=r.value,M=void 0,(M=b.downloads)==null?0:M.length)for(w=g.u(b.downloads),U=w.next();!U.done;U=w.next())C=U.value,C.videoItem&&(Q=g.ny(C.videoItem).entityId,t.add(Q));if(W.videos){d=g.u(W.videos);for(N=d.next();!N.done;N=d.next())S=N.value,h=JSON.parse(g.ny(S).entityId),h.videoId&&!t.has(h.videoId)&&K.push(h.videoId);V=g.u(e);for(Y=V.next();!Y.done;Y=V.next())if(A=Y.value,A.key!==W.key&&(v=A.videos))for(q=
g.u(v),X=q.next();!X.done;X=q.next())y=X.value,iC=JSON.parse(g.ny(y).entityId),iC.videoId&&(aG=K.indexOf(iC.videoId),aG!==-1&&K.splice(aG,1))}return Wf.return(K)})},g3U=function(W,e){var l,K,t,a,r,b,M,w;
return g.L(function(U){l=Qq(W.avatar);K=g.u(e);for(t=K.next();!t.done;t=K.next())if(a=t.value,a.id!==W.id)for(r=g.u(Qq(a.avatar)),b=r.next();!b.done;b=r.next())M=b.value,w=l.indexOf(M),w!==-1&&l.splice(w,1);return U.return(l)})},YQJ=function(W){var e;
return g.L(function(l){e=g.f(W.frameworkUpdates,B3);return W.frameworkUpdates&&e?g.O(l,Hln(e),0):l.return()})},Afs=function(W){var e;
if((e=W.onResponseReceivedActions)!=null&&e.length){var l;W=(l=g.f(g.f(W.onResponseReceivedActions[0],OP_),g.Tuk))==null?void 0:l.actions;if(W!=null&&W.length)return W}},LzK=function(W){var e,l,K;
return g.L(function(t){if(t.L==1)return W?g.O(t,za(W,g.Z6,"mainDownloadsListEntity"),2):t.return([]);e=t.K;return((l=e)==null?0:(K=l.downloads)==null?0:K.length)?t.return(e.downloads.map(function(a){var r;return(r=a.videoItem)!=null?r:""})):t.return([])})},v3z=function(W,e){var l;
return g.L(function(K){return K.L==1?g.O(K,DlU(W,e),2):(l=K.K)?g.O(K,yo(W,{mode:"readwrite",Gw:!0},function(t){var a=[Ga(t,l.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];l.mainDownloadsListEntity&&a.push(Ga(t,l.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.hQ.all(a)}),0):K.lq(0)})},DlU=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A;
return g.L(function(v){if(v.L==1)return l=g.zo("main_downloads_library_id","mainDownloadsLibraryEntity"),K=g.zo("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.O(v,yo(W,{mode:"readonly",Gw:!0},function(q){return g.hQ.all([P5(q,l,"mainDownloadsLibraryEntity"),P5(q,K,"mainDownloadsListEntity")])}),2);
t=v.K;a=g.u(t);r=a.next().value;b=a.next().value;M=r;w=b;M||(M={id:l});U=g.u(e);for(C=U.next();!C.done;C=U.next())if(Q=C.value,Q===g.Z6){if(M.smartDownloadsList)return v.return();M.smartDownloadsList=Q}else if(d=g.ny(Q).entityType,N={},d==="mainPlaylistEntity"?N.playlistItem=Q:d==="mainVideoEntity"&&(N.videoItem=Q),!g.D0(N)){S=void 0;if((S=w)==null?0:S.downloads){h=!1;V=g.u(w.downloads);for(Y=V.next();!Y.done;Y=V.next())if(A=Y.value,A.playlistItem===Q||A.videoItem===Q){h=!0;break}h||w.downloads.push(N)}else w=
{id:K,downloads:[N]};M.downloadsList=K}return v.return({mainDownloadsLibraryEntity:M,mainDownloadsListEntity:w})})},Jfp=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h;
return g.L(function(V){if(V.L==1)return l=g.zo("main_downloads_library_id","mainDownloadsLibraryEntity"),K=g.zo("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.O(V,yo(W,{mode:"readonly",Gw:!0},function(Y){return g.hQ.all([P5(Y,l,"mainDownloadsLibraryEntity"),P5(Y,K,"mainDownloadsListEntity"),P5(Y,g.Z6,"mainDownloadsListEntity")])}),2);
t=V.K;a=g.u(t);r=a.next().value;b=a.next().value;M=a.next().value;w=r;U=b;C=M;if(!w)return V.lq(0);if(e===g.Z6&&((Q=C)==null?0:Q.downloads))C.downloads=[];else if((d=U)==null?0:d.downloads)for(N=g.ny(e).entityType,S=0;S<U.downloads.length;S++)if(h=U.downloads[S],N==="mainVideoEntity"&&h.videoItem===e){U.downloads.splice(S,1);break}else if(N==="mainPlaylistEntity"&&h.playlistItem===e){U.downloads.splice(S,1);break}return g.O(V,yo(W,{mode:"readwrite",Gw:!0},function(Y){var A=[Ga(Y,w,"mainDownloadsLibraryEntity")];
U&&A.push(Ga(Y,U,"mainDownloadsListEntity"));C&&A.push(Ga(Y,C,"mainDownloadsListEntity"));return g.hQ.all(A)}),0)})},h_=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q;
return g.L(function(d){if(d.L==1)return l=g.zo(e,"transfer"),K=g.zo(e,"videoDownloadContextEntity"),g.O(d,yo(W,{mode:"readonly",Gw:!0},function(N){return g.hQ.all([P5(N,l,"transfer"),P5(N,K,"videoDownloadContextEntity")])}),2);
t=d.K;a=g.u(t);r=a.next().value;b=a.next().value;M=r;w=b;Q={videoId:e,cotn:(U=M)==null?void 0:U.cotn,offlineModeType:(C=w)==null?void 0:C.offlineModeType};return d.return(Q)})},oI=function(W,e,l,K,t){var a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC;
return g.L(function(aG){switch(aG.L){case 1:return a=g.zo(W,"musicTrack"),r=g.zo(W,"transfer"),g.O(aG,yo(e,{mode:"readonly",Gw:!0},function(Wf){return g.hQ.all([P5(Wf,a,"musicTrack"),P5(Wf,r,"transfer"),qY(Wf,"musicTrack"),qY(Wf,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=aG.K;M=g.u(b);w=M.next().value;U=M.next().value;C=M.next().value;Q=M.next().value;d=w;N=U;S=C;h=Q;if(!d){aG.lq(3);break}return g.O(aG,E3C(d,S),4);case 4:return V=aG.K,g.O(aG,uQ(V),3);case 3:Y=[];A=g.u(h);for(v=A.next();!v.done;v=A.next())q=v.value,X=g.ny(q.key).entityId,y=Nm(q),iC=g.ny(y.action.entityKey).entityId,X!==W&&iC!==W||Uw(l,q.actionProto)||Y.push(q.key);return g.O(aG,yo(e,{mode:"readwrite",Gw:!0},function(Wf){var G=Y.map(function(m){return Ta(Wf,m)});
G.push(Ta(Wf,a,{vX:!0}));return g.hQ.all(G)}),6);
case 6:Cd(N),t&&aI(t),Kd(K,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.uC(aG)}})},gL=function(W,e,l,K,t){var a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU,rx,NK,p,Z,F;
return g.L(function(D){switch(D.L){case 1:return a=g.zo(W,e),r=g.zo("music_downloads_library_id","musicDownloadsLibraryEntity"),g.O(D,yo(l,{mode:"readonly",Gw:!0},function(J){return g.hQ.all([P5(J,a,e),P5(J,r,"musicDownloadsLibraryEntity"),qY(J,e),qY(J,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=D.K;M=g.u(b);w=M.next().value;U=M.next().value;C=M.next().value;Q=M.next().value;d=w;N=U;S=C;h=Q;if(!d){D.lq(3);break}return g.O(D,E3C(d,S),4);case 4:return V=D.K,g.O(D,uQ(V),3);case 3:Y=[];A=new Map;if(!d){D.lq(6);break}return g.O(D,HPp(d,S,N),7);case 7:Y=D.K;v=g.u(Y);for(q=v.next();!q.done;q=v.next())X=q.value,y=g.ny(X).entityId,A.set(y,{videoId:y,playlistId:W,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.O(D,mC(l,"transfer"),8);case 8:for(iC=D.K,aG=g.u(iC),
Wf=aG.next();!Wf.done;Wf=aG.next())G=Wf.value,m=g.ny(G.key).entityId,(c=A.get(m))&&G&&(c.cotn=G.cotn);case 6:T=[];Pf=g.u(h);for(on=Pf.next();!on.done;on=Pf.next())dx=on.value,pH=g.ny(dx.key).entityId,jU=Nm(dx),pH!==W&&jU.rootActionId!==W||Uw(K,dx.actionProto)||T.push(dx.key);rx=g.zo(W,e);return g.O(D,yo(l,{mode:"readwrite",Gw:!0},function(J){var jl=T.map(function(KH){return Ta(J,KH)});
jl.push(Ta(J,rx,{vX:!0}));return g.hQ.all(jl)}),9);
case 9:if(!d){D.lq(0);break}Y.reverse();if(!Y.length){D.lq(0);break}NK=g.u(Y);p=NK.next();case 12:if(p.done){D.lq(0);break}Z=p.value;F=g.ny(Z).entityId;if(!F){D.lq(13);break}return g.O(D,oI(F,l,K,t,A.get(F)),13);case 13:p=NK.next(),D.lq(12)}})},pd=function(W,e,l){var K,t,a,r,b,M,w;
return g.L(function(U){if(U.L==1)return g.O(U,yo(W,{mode:"readwrite",Gw:!0},function(C){var Q=qY(C,"transfer"),d=qY(C,"offlineOrchestrationActionWrapperEntity");return g.hQ.all([Q,d]).then(function(N){N=g.u(N);var S=N.next().value;var h=N.next().value;N=PPk.map(function(v){return pMt(C,v)});
h=g.u(h);for(var V=h.next();!V.done;V=h.next()){V=V.value;var Y=g.ny(V.actionProto.entityKey).entityType==="musicTrack",A=V.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Uw(e,V.actionProto)||Y&&(!Y||A)||N.push(Ta(C,V.key,{vX:!0}))}return g.hQ.all(N).then(function(){return S})})}),2);
K=U.K;t=g.u(K);for(a=t.next();!a.done;a=t.next())r=a.value,Cd(r),b=g.ny(r.key).entityId,M={videoId:b,offlineDeleteReason:void 0,cotn:r.cotn},aI(M),w=g.zo(b,"musicTrack"),Kd(l,{entityKey:w,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.O(U,o3p(),0)})},qQJ=function(W){for(var e,l=g.u(W.additionalMetadatas),K=l.next();!K.done;K=l.next())K=K.value,K.offlineMusicVideoData&&(e=K.offlineMusicVideoData);
var t,a,r,b,M;return{id:g.zo(W.videoId,"musicTrack"),videoId:W.videoId,title:W.title,thumbnailDetails:W.thumbnail,lengthMs:String(Number(W.lengthSeconds)*1E3),albumTitle:(t=e)==null?void 0:t.releaseTitle,musicVideoType:(a=e)==null?void 0:a.musicVideoType,contentRating:{explicitType:(r=e)==null?void 0:r.explicitType},artistNames:((b=e)==null?void 0:b.byline)||((M=e)==null?void 0:M.channelName),downloadMetadata:g.zo(W.videoId,"musicTrackDownloadMetadataEntity")}},HPp=function(W,e,l){var K,t,a,r,b,M,
w,U,C,Q,d,N,S,h,V,Y,A,v;
return g.L(function(q){K=[];t=new Set;if((a=l)==null?0:(r=a.downloadedTracks)==null?0:r.length)for(b=g.u(l.downloadedTracks),M=b.next();!M.done;M=b.next())w=M.value,t.add(w);if(W.tracks){U=g.u(W.tracks);for(C=U.next();!C.done;C=U.next())Q=C.value,t.has(Q)||K.push(Q);d=g.u(e);for(N=d.next();!N.done;N=d.next())if(S=N.value,S.id!==W.id&&(h=S.tracks))for(V=g.u(h),Y=V.next();!Y.done;Y=V.next())A=Y.value,v=K.indexOf(A),v!==-1&&K.splice(v,1)}return q.return(K)})},E3C=function(W,e){var l,K,t,a,r,b,M,w;
return g.L(function(U){l=Qq(W.thumbnailDetails);K=g.u(e);for(t=K.next();!t.done;t=K.next())if(a=t.value,a.id!==W.id)for(r=g.u(Qq(a.thumbnailDetails)),b=r.next();!b.done;b=r.next())M=b.value,w=l.indexOf(M),w!==-1&&l.splice(w,1);return U.return(l)})},fO_=function(W,e){var l,K,t,a,r,b,M,w,U;
return g.L(function(C){if(C.L==1)return l=g.zo("music_downloads_library_id","musicDownloadsLibraryEntity"),g.O(C,za(W,l,"musicDownloadsLibraryEntity"),2);(K=C.K)||(K={id:l});t=g.ny(e).entityType;t==="musicTrack"?(a=K.downloadedTracks)!=null&&a.includes(e)||(K.downloadedTracks=((r=K.downloadedTracks)!=null?r:[]).concat(e)):t==="musicPlaylist"?(b=K.downloadedPlaylists)!=null&&b.includes(e)||(K.downloadedPlaylists=((M=K.downloadedPlaylists)!=null?M:[]).concat(e)):t!=="musicAlbumRelease"||(w=K.downloadedAlbumReleases)!=
null&&w.includes(e)||(K.downloadedAlbumReleases=((U=K.downloadedAlbumReleases)!=null?U:[]).concat(e));return g.O(C,nE(W,K,"musicDownloadsLibraryEntity"),0)})},G8K=function(W,e){var l,K,t,a,r,b,M;
return g.L(function(w){if(w.L==1)return l=g.zo("music_downloads_library_id","musicDownloadsLibraryEntity"),g.O(w,za(W,l,"musicDownloadsLibraryEntity"),2);K=w.K;if(!K)return w.lq(0);t=g.ny(e).entityType;t==="musicTrack"?a=K.downloadedTracks:t==="musicPlaylist"&&(a=K.downloadedPlaylists);if((r=a)==null?0:r.length)for(b=0;b<a.length;b++)if(M=a[b],M===e){a.splice(b,1);break}return g.O(w,nE(W,K,"musicDownloadsLibraryEntity"),0)})},TCx=function(W){var e=W.videos;
W=[];var l=[];if(e){e=g.u(e);for(var K=e.next();!K.done;K=e.next()){var t=K.value.offlineVideoData.videoId;K=g.zo(t,"musicTrack");t=g.zo(t,"musicTrackDownloadMetadataEntity");W.push(K);l.push(t)}}return{Xc:W,EB:l}},Vq=function(W,e,l){e={track:qQJ(e)};
l&&(e.playlistId=l);if(W=g.f(W.actionMetadata,xl3))e.maximumDownloadQuality=W.maximumDownloadQuality;return{musicTrackEntityActionMetadata:e}},yfC=function(W){var e,l,K,t,a,r,b,M;
return g.L(function(w){switch(w.L){case 1:return e=g.Ky(),l=y0K(W),K=g.Wl(IO2),g.cf(w,2),a={EP:!0},g.O(w,g.Ix(e,l,K,void 0,a),4);case 4:t=w.K;g.hm(w,3);break;case 2:r=g.oG(w);if(r instanceof g.et)throw b="GetOffline network manager error: "+r.message,lQ(b,r),Error(b);lQ("GetOffline fetch request error",r);throw Error("GetOffline fetch request error");case 3:M=Z7(t);if(!t)throw lQ("Network request failed"),Error("Network request failed");if(M!==void 0)F$(M);else if(!t.videos||!t.videos.length)throw lQ("No data"),
Error("No data");return w.return(t.videos.map(function(U){return U.offlineVideoData}))}})},n3_=function(W){var e,l,K,t,a,r,b,M;
return g.L(function(w){switch(w.L){case 1:return e=g.Ky(),l=nLz(W),K=g.Wl(IO2),g.cf(w,2),a={EP:!0},g.O(w,g.Ix(e,l,K,void 0,a),4);case 4:t=w.K;g.hm(w,3);break;case 2:r=g.oG(w);if(r instanceof g.et)throw b="GetOffline network manager error for playlist: "+r.message,lQ(b,r),Error(b);lQ("GetOffline fetch request error for playlist",r);throw Error("GetOffline fetch request error for playlist");case 3:M=Z7(t);if(!t)throw lQ("Network request failed for playlist"),Error("Network request failed for playlist");
if(M!==void 0)F$(M,"playlist");else if(!t.playlists||!t.playlists.length)throw lQ("No data for playlist"),Error("No data for playlist");return w.return(t.playlists.map(function(U){return U.offlinePlaylistData}))}})},mlK=function(W,e,l,K){var t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx;
return g.L(function(pH){switch(pH.L){case 1:return g.O(pH,Xm(),2);case 2:t=pH.K;if(!t)return pH.return([]);a=[];if((r=K)==null?0:r.length){a=K;pH.lq(3);break}return g.O(pH,mC(t,"mainPlaylistEntity"),4);case 4:a=pH.K;case 3:if(!a.length)return pH.return([]);b=[];M=Date.now()/1E3;w=g.u(a);U=w.next();case 5:if(U.done)return b.length?g.O(pH,zut(b),10):pH.return([]);C=U.value;if(!C.downloadState){Q=void 0;pH.lq(8);break}return g.O(pH,za(t,C.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:Q=
pH.K;case 8:d=Q;N=void 0;h=(S=(N=C)==null?void 0:N.entityMetadata)&&S.nextAutoRefreshIntervalSeconds?Number(S.nextAutoRefreshIntervalSeconds):NaN;V=Number.isNaN(h)?W:h;A=Y=void 0;v=((Y=d)==null?0:Y.lastSyncedTimestampMillis)?Number((A=d)==null?void 0:A.lastSyncedTimestampMillis)/1E3:0;X=q=void 0;y=((q=d)==null?0:q.addedTimestampMillis)?Number((X=d)==null?void 0:X.addedTimestampMillis)/1E3:0;if(l||!S||v+V<=M){iC=[];aG=void 0;if((aG=C.videos)==null?0:aG.length)for(Wf=g.u(C.videos),G=Wf.next();!G.done;G=
Wf.next())m=G.value,c=JSON.parse(g.ny(m).entityId),c.videoId&&iC.push(c.videoId);T="0";S&&(Pf=void 0,T=String(Number((Pf=S.offlineLastModifiedTimestampSeconds)!=null?Pf:0).toFixed()));on={playlistId:C.playlistId,videoIds:iC,offlineLastModifiedTimestamp:T,autoSync:e,offlineDateAddedTimestamp:String(y.toFixed())};b.push(on)}U=w.next();pH.lq(5);break;case 10:return dx=pH.K,pH.return(dx)}})},X0C=function(){var W,e,l,K,t;
return g.L(function(a){if(a.L==1)return g.O(a,Xm(),2);if(a.L!=3)return(W=a.K)?g.O(a,mC(W,"refresh"),3):a.return(!1);e=a.K;if((l=e[0])==null||!l.refreshTime)return a.return(!1);K=Number(e[0].refreshTime);t=Date.now()/1E3;return a.return(isFinite(K)&&t>=K)})},jPn=function(W,e){var l,K,t;
return g.L(function(a){switch(a.L){case 1:return g.cf(a,2),g.O(a,W8x(W,e),4);case 4:return K=a.K,g.O(a,YQJ(K),5);case 5:l=Afs(K);g.hm(a,3);break;case 2:t=g.oG(a),lQ("getAndProcessSmartDownloadsResponse request or processing error",t);case 3:return a.return(l)}})},eRv=function(W,e,l,K){var t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx;
return g.L(function(pH){switch(pH.L){case 1:return g.O(pH,Xm(),2);case 2:t=pH.K;if(!t)return pH.return([]);a=[];if((r=K)==null?0:r.length){a=K;pH.lq(3);break}return g.O(pH,mC(t,"musicPlaylist"),4);case 4:a=pH.K;case 3:if(!a.length)return pH.return([]);b=[];M=Date.now()/1E3;w=g.u(a);U=w.next();case 5:if(U.done)return b.length?g.O(pH,zut(b),10):pH.return([]);C=U.value;Q=void 0;N=(d=(Q=C)==null?void 0:Q.entityMetadata)&&d.nextAutoRefreshIntervalSeconds?Number(d.nextAutoRefreshIntervalSeconds):NaN;S=
Number.isNaN(N)?W:N;V=h=0;Y="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!C.downloadMetadata){pH.lq(8);break}return g.O(pH,za(t,C.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:A=pH.K,q=v=void 0,h=Number((q=(v=A)==null?void 0:v.addedTimestampMillis)!=null?q:"0")/1E3,y=X=void 0,V=Number((y=(X=A)==null?void 0:X.lastModifiedTimestampMillis)!=null?y:"0")/1E3,aG=iC=void 0,Y=(aG=(iC=A)==null?void 0:iC.syncState)!=null?aG:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Wf=void 0;if(l||Y!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!d||Number((Wf=d.lastSyncedTimestampSeconds)!=null?Wf:0)+S<=M){G=[];m=void 0;if((m=C.tracks)==null?0:m.length)for(c=g.u(C.tracks),T=c.next();!T.done;T=c.next())Pf=T.value,G.push(g.ny(Pf).entityId);on={playlistId:C.playlistId,videoIds:G,offlineLastModifiedTimestamp:String(V.toFixed()),autoSync:e,offlineDateAddedTimestamp:String(h.toFixed())};b.push(on)}U=w.next();pH.lq(5);break;case 10:return dx=pH.K,pH.return(dx)}})},W8x=function(W,e){var l,K,t,a,r,b,M,w,U,C;
return g.L(function(Q){switch(Q.L){case 1:return l=g.Ky(),g.O(Q,Xm(),2);case 2:K=Q.K;if(!K){Q.lq(3);break}return g.O(Q,lO3(K),4);case 4:t=Q.K;case 3:var d=t;a={context:g.zn(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:W},offlineClientState:d,clientStateRequestData:{preferredFormatType:e}}}};r=g.Wl(l$U);g.cf(Q,5);M={EP:!0};return g.O(Q,g.Ix(l,a,r,void 0,M),7);case 7:b=Q.K;g.hm(Q,6);break;case 5:w=g.oG(Q);if(w instanceof g.et)throw U=
"DPS network manager error for smart downloads: "+w.message,lQ(U,w),Error(U);lQ("DPS fetch request error for smart downloads",w);throw Error("DPS fetch request error for smart downloads");case 6:C=Z7(b);if(b)C!==void 0&&F$(C,"smart downloads");else throw lQ("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return Q.return(b)}})},K82=function(W,e){var l,K,t,a,r,b,M,w;
return g.L(function(U){switch(U.L){case 1:return l=g.Ky(),K={context:g.zn(),videoPlaybackPositionEntities:W,lastSyncTimestampUsec:e},t=g.Wl(iRv),g.cf(U,2),r={EP:!0},g.O(U,g.Ix(l,K,t,void 0,r),4);case 4:a=U.K;g.hm(U,3);break;case 2:b=g.oG(U);if(b instanceof g.et)throw M="VPPS network manager error: "+b.message,lQ(M,b),Error(M);lQ("VPPS fetch request error",b);throw Error("VPPS fetch request error");case 3:w=Z7(a);if(a)w!==void 0&&F$(w,"position sync");else throw lQ("Network request failed for position sync"),
Error("Network request failed for position sync");return U.return(a)}})},a$K=function(W,e,l){var K,t,a,r,b,M,w,U;
return g.L(function(C){switch(C.L){case 1:K=g.Ky();var Q=l.refreshData,d=l.isEnqueuedForExpiredStreamUrlRefetch,N=l.NF,S=l.offlineSourceData,h=l.mediaCapabilities,V={entityKey:W};Q&&(V.refreshData=Q);d&&(V.isExpiredStreamUrlRefetch=d);N&&(V.downloadParameters=N);S&&(V.offlineSourceData=S);Q={context:g.tL(e),signatureTimestamp:20178,videos:[V]};h&&(Q.mediaCapabilities=h);t=Q;a=g.Wl(tV3);g.cf(C,2);b={EP:!0};return g.O(C,g.Ix(K,t,a,void 0,b),4);case 4:r=C.K;g.hm(C,3);break;case 2:M=g.oG(C);if(M instanceof
g.et)throw w="GetPDE network manager error: "+M.message,lQ(w,M),Error(w);lQ("GetPDE fetch request error",M);throw Error("GetPDE fetch request error");case 3:U=Z7(r);if(r)U!==void 0&&F$(U,"PDE");else throw lQ("Network request failed for PDE"),Error("Network request failed for PDE");return C.return(r)}})},Z7=function(W){var e;
return(e=W.errorMetadata)==null?void 0:e.status},F$=function(W,e){e=e?" for "+e:"";
if(W===0)throw W="Empty response body"+e,lQ(W),Error(W);W="Response with error"+e;lQ(W);throw Error(W);},zut=function(W){var e,l,K,t,a,r,b,M;
return g.L(function(w){switch(w.L){case 1:return e=g.Ky(),l=zTJ(W),K=g.Wl(rwn),g.cf(w,2),a={EP:!0},g.O(w,g.Ix(e,l,K,void 0,a),4);case 4:t=w.K;g.hm(w,3);break;case 2:r=g.oG(w);if(r instanceof g.et)throw b="offlinePlaylistSyncCheck network manager error: "+r.message,lQ(b,r),Error(b);lQ("offlinePlaylistSyncCheck fetch request error",r);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:M=Z7(t);if(!t)throw lQ("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(M!==void 0)F$(M,"playlist sync");else if(!t.offlinePlaylistSyncCheckDatas||!t.offlinePlaylistSyncCheckDatas.length)throw lQ("No data for playlist sync"),Error("No data for playlist sync");return w.return(t.offlinePlaylistSyncCheckDatas.map(function(U){return U.offlinePlaylistSyncCheckData}))}})},Y4=function(W){this.L=W},kPx=function(W,e){var l,K,t,a,r,b;
return g.L(function(M){switch(M.L){case 1:l=new Map,K=g.u(e),t=K.next();case 2:if(t.done){M.lq(4);break}a=t.value;r=l;b=r.set;return g.O(M,W.K(a),5);case 5:b.call(r,a,M.K);t=K.next();M.lq(2);break;case 4:return M.return(l)}})},Ow=function(W,e,l,K,t,a){e=g.zo(e,l);
K=Object.assign({},a,{priority:K,retryScheduleIntervalsInSeconds:t});return{actionType:W,entityKey:e,actionMetadata:K}},A_=function(W,e,l,K,t,a){this.status=W;
this.L=e;this.J=l;this.K=K;this.X=t;this.downloadState=a},bR2=function(W,e,l){this.L=W;
this.OT=e;this.X=l},wTt=function(W,e){var l,K,t,a,r,b,M,w,U;
return g.L(function(C){switch(C.L){case 1:return l=e.entityKey,t=(K=g.f(e.actionMetadata,Ld))==null?void 0:K.isEnqueuedForExpiredStreamUrlRefetch,g.cf(C,2),a=void 0,g.O(C,$z_(W,e),4);case 4:a=C.K;g.cf(C,5);var Q=(Q=g.f(e.actionMetadata,Ld))?{maximumDownloadQuality:Q.maximumDownloadQuality}:void 0;return g.O(C,a$K(l,W.OT,{isEnqueuedForExpiredStreamUrlRefetch:t,NF:Q,offlineSourceData:a}),7);case 7:r=C.K;g.hm(C,6,2);break;case 5:return g.oG(C,2),b=k4(e)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",lQ("PDE handleAdd error"),C.return(D7(e,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",b,"DOWNLOAD_STATE_FAILED"));case 6:return g.O(C,MVK(W,r,e),8);case 8:return C.return(D7(e,!0,r.orchestrationActions));case 2:return M=g.oG(C),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.dE&&M.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),lQ("PDE handleAdd error"),C.return(D7(e,!1,void 0,w,U,"DOWNLOAD_STATE_FAILED"))}})},QPs=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG;
return g.L(function(Wf){switch(Wf.L){case 1:return l=e.entityKey,K=g.ny(l).entityId,g.O(Wf,yo(W.L,{mode:"readonly",Gw:!0},function(G){var m=P5(G,l,"playbackData"),c=P5(G,g.zo(K,"offlineVideoPolicy"),"offlineVideoPolicy");G=P5(G,g.zo(K,"transfer"),"transfer");return g.hQ.all([m,c,G])}),2);
case 2:t=Wf.K;a=g.u(t);r=a.next().value;b=a.next().value;M=a.next().value;w=r;U=b;C=M;if(!w||!U)return Wf.return(D7(e,!0));Q=[];S=((N=w)==null?0:N.playerResponseJson)?JSON.parse(w.playerResponseJson):null;if(!(C&&S&&W.OT.W("html5_refresh_deprecated_downloads"))){Wf.lq(3);break}d=Uzt(W,S,C);return g.O(Wf,CMt(W,C),4);case 4:Q=Wf.K;case 3:h={lastPlayerResponseTimestampSeconds:w.playerResponseTimestamp,offlineToken:U.offlineToken,formatIds:Q};V={};if((Y=C)==null?0:Y.maximumDownloadQuality)V.maximumDownloadQuality=
C.maximumDownloadQuality;g.cf(Wf,5);A=void 0;return g.O(Wf,$z_(W,e),7);case 7:return A=Wf.K,g.cf(Wf,8),g.O(Wf,a$K(l,W.OT,{refreshData:h,NF:V,offlineSourceData:A,mediaCapabilities:d}),10);case 10:v=Wf.K;g.hm(Wf,9,5);break;case 8:return g.oG(Wf,5),q=k4(e)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",lQ("PDE handleRefresh error"),Wf.return(D7(e,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",q,
"DOWNLOAD_STATE_FAILED"));case 9:return g.O(Wf,MVK(W,v,e),11);case 11:return Wf.return(D7(e,!0,v.orchestrationActions));case 5:return X=g.oG(Wf),y="PDE handleRefresh error",X instanceof Error&&(y="PDE handleRefresh error: "+X.message),iC="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",aG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.dE&&X.type==="QUOTA_EXCEEDED"&&(iC="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",aG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
lQ(y),Wf.return(D7(e,!1,void 0,iC,aG,"DOWNLOAD_STATE_FAILED"))}})},$z_=function(W,e){var l,K,t,a;
return g.L(function(r){if(r.L==1)return l=g.ny(e.entityKey).entityId,K=g.zo(l,"videoDownloadContextEntity"),g.O(r,za(W.L,K,"videoDownloadContextEntity"),2);t=r.K;return(a=t)!=null&&a.offlineModeType?r.return({offlineModeType:t.offlineModeType}):r.return(void 0)})},MVK=function(W,e,l){var K,t,a,r,b;
return g.L(function(M){if(M.L==1){if(!e.frameworkUpdates||!g.f(e.frameworkUpdates,B3))return M.return();if(!(g.f(e.frameworkUpdates,B3).mutations&&g.f(e.frameworkUpdates,B3).mutations.length>0&&g.f(e.frameworkUpdates,B3).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return M.lq(2);K=g.ny(g.f(e.frameworkUpdates,B3).mutations[0].entityKey).entityId;return g.O(M,h_(W.L,K),3)}if(M.L!=2){t=M.K;a=g.f(l.actionMetadata,Ld);if(b=(r=a)==null?void 0:r.playlistId)t.playlistId=b;t.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.nn(W.OT)?g.O(M,Sr(K,W.L,l,W.X,t),2):g.vZ(W.OT)?g.O(M,oI(K,W.L,l,W.X),2):M.lq(2)}return g.O(M,Hln(g.f(e.frameworkUpdates,B3)),0)})},D7=function(W,e,l,K,t,a){return new A_(e?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k4(W),l,K,t,a)},Uzt=function(W,e,l){e=BCk(W.OT,l.cotn,e);
l=g.az(e);return g.DMQ(e,l,W.OT)},CMt=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q;
return g.L(function(d){if(d.L==1)return l=[],g.O(d,yo(W.L,{mode:"readonly",Gw:!0},function(N){var S=[],h=e.offlineVideoStreams;if(h){h=g.u(h);for(var V=h.next();!V.done;V=h.next())S.push(P5(N,V.value,"offlineVideoStreams"))}return g.hQ.all(S)}),2);
if(K=d.K)for(t=g.u(K),a=t.next();!a.done;a=t.next())if(r=a.value,b=void 0,(b=r)==null?0:b.streamsProgress)for(M=r.streamsProgress,w=0;w<M.length;w++)U=M[w],C=JSON.parse(U.formatStreamBytes),Q={itag:C.itag,lmt:C.lastModified,xtags:C.xtags},l.push(Q);return d.return(l)})},dzz=function(W,e){this.L=W;
this.OT=e},NO_=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d;
return g.L(function(N){switch(N.L){case 1:return l=k4(e),g.O(N,mC(W.L,"videoPlaybackPositionEntity"),2);case 2:K=N.K;if(K.length===0)return N.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.cf(N,3);return g.O(N,JT.getInstance(),5);case 5:t=N.K;if(!t)throw Error("prefStorage is undefined");return g.O(N,t.get("psi"),6);case 6:return a=N.K,M=(b=(r=a)==null?void 0:r.sL)!=null?b:"0",g.O(N,K82(K,M),7);case 7:return w=N.K,U={isPaused:w.watchHistoryPaused,sL:w.syncTimestampUsec},g.O(N,t.set("psi",
U),8);case 8:if(U.isPaused){N.lq(9);break}C=g.f(w.frameworkUpdates,B3);if(!w.frameworkUpdates||!C){N.lq(9);break}return g.O(N,Hln(C),9);case 9:g.hm(N,4);break;case 3:return Q=g.oG(N),d="PPE handleRefresh error: "+(Q instanceof Error?Q.message:"unknown error"),lQ(d),N.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},uVx=function(W,e){var l,K,t,a,r,b,M,w;
return g.L(function(U){switch(U.L){case 1:return l=k4(e),K=g.ny(e.entityKey).entityId,g.cf(U,2),g.O(U,JT.getInstance(),4);case 4:t=U.K;if(!t)throw Error("prefStorage is undefined");return g.O(U,t.get("psi"),5);case 5:a=U.K;r=g.f(e.actionMetadata,RRx);if(((b=a)==null?void 0:b.isPaused)!==!1||(M=r)==null||!M.lastPlaybackPositionSeconds){U.lq(6);break}w={key:g.zo(K,"videoPlaybackPositionEntity"),videoId:K,lastPlaybackPositionSeconds:r.lastPlaybackPositionSeconds};return g.O(U,nE(W.L,w,"videoPlaybackPositionEntity"),
6);case 6:g.hm(U,3);break;case 2:return g.oG(U),U.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},cwv=function(W,e){var l,K,t;
return g.L(function(a){switch(a.L){case 1:l=k4(e);g.cf(a,2);K=g.ny(e.entityKey).entityId;if(K==="!*$_ALL_ENTITIES_!*$")return g.O(a,LpJ(W.L),5);t=g.zo(K,"videoPlaybackPositionEntity");return g.O(a,A0J(W.L,t),5);case 5:g.hm(a,3);break;case 2:return g.oG(a),a.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},SE2=function(W,e){this.api=W;
this.L=e;this.logger=new g.tK("woffle");this.K=!1;this.Xi={GA:this.GA};this.logger.debug("Initialized OfflineMediaManager")},BOx=function(W){return g.L(function(e){return e.return(ImK(W))})},hRJ=function(W){var e;
return g.L(function(l){if(l.L==1)return g.O(l,g.tpE(W),2);e=l.K;return l.return(e.filter(function(K){return!!K.url}).map(function(K){return K.url}))})},v3=function(W,e){var l=g.s8(e);
if(l===1||l===0)return Promise.resolve();(l=oAC(W,e))&&l.stopVideo();W.X=0;return BOx(e)},J_=function(W,e,l,K){l=l===void 0?!1:l;
K=K===void 0?!0:K;var t=typeof e==="string"?e:e.videoDetails.videoId;g.s8(t)===2&&((e=oAC(W,t))?e.stopVideo():W.logger.info(function(){return"Corresponding player for "+t+" not found. Pausing anyway"}),g.ZK(t,2),W.X=2,l?gAK(W.L):K&&pTK(W.L))},oAC=function(W,e){var l;
return((l=W.player)==null?void 0:l.getVideoData().videoId)===e?W.player:null},VVK=function(W,e,l){e.getPlayerResponse();
g.ZK(e.videoId,2);W.X=2;W.K=!1;var K;(K=W.player)==null||K.dispose();W.player=W.api.L6(e);e={};W.player.p4((e.localmediachange=W.oT,e.signatureexpired=W.QI,e.statechange=W.UBT,e),W);var t=W.GA(l);W.player.WA(g.Kr(t,t,!0,"m"),!1);W.logger.debug(function(){return"Starting headless playback with quality: "+t});
W.player.JD(!1)},sP_=function(W,e){this.L=W;
this.OT=e},F8U=function(W,e){var l,K;
return g.L(function(t){switch(t.L){case 1:return l=k4(e),g.O(t,za(W.L,e.entityKey,"transfer"),2);case 2:if(K=t.K)return t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.cf(t,3);return g.O(t,ZRt(W,e),5);case 5:g.hm(t,4);break;case 3:return g.oG(t),t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},YEJ=function(W,e){var l,K;
return g.L(function(t){switch(t.L){case 1:return l=k4(e),g.O(t,za(W.L,e.entityKey,"transfer"),2);case 2:K=t.K;if(!K||K.transferState!=="TRANSFER_STATE_COMPLETE")return t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.cf(t,3);return g.O(t,ZRt(W,e,!0),5);case 5:g.hm(t,4);break;case 3:return g.oG(t),t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},ORU=function(W,e){var l,K,t,a,r,b,M,w,U,C;
return g.L(function(Q){switch(Q.L){case 1:return l=k4(e),K=g.ny(e.entityKey).entityId,g.O(Q,yo(W.L,{mode:"readonly",Gw:!0},function(d){var N=P5(d,e.entityKey,"transfer");d=P5(d,g.zo(K,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.hQ.all([N,d])}),2);
case 2:t=Q.K;a=g.u(t);r=a.next().value;b=a.next().value;M=r;w=b;if(!M||M.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return Q.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.cf(Q,3);M.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.O(Q,nE(W.L,M,"transfer"),5);case 5:U=g.ny(M.key).entityId;rL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:U,le:M,offlineModeType:(C=w)==null?void 0:C.offlineModeType});g.hm(Q,
4);break;case 3:return g.oG(Q),Q.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Q.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},ZRt=function(W,e,l){l=l===void 0?!1:l;
var K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V;return g.L(function(Y){switch(Y.L){case 1:return K=g.f(e.actionMetadata,AwU),t=g.ny(e.entityKey).entityId,a=g.zo(t,"downloadStatusEntity"),g.O(Y,yo(W.L,{mode:"readonly",Gw:!0},function(A){var v=P5(A,a,"downloadStatusEntity");A=P5(A,g.zo(t,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.hQ.all([v,A])}),2);
case 2:return r=Y.K,b=g.u(r),M=b.next().value,w=b.next().value,U=M,C=w,Q="TRANSFER_STATE_TRANSFER_IN_QUEUE",((d=U)==null?void 0:d.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(Q="TRANSFER_STATE_PAUSED_BY_USER"),h={key:e.entityKey,transferState:Q,cotn:g.h2(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(N=K)==null?void 0:N.maximumDownloadQuality,preferredAudioTrack:(S=K)==null?void 0:S.preferredAudioTrack,transferRetryCount:0,isRefresh:l,hasLoggedFirstStarted:!1},g.O(Y,yo(W.L,
{mode:"readwrite",Gw:!0},function(A){var v=[];l&&v.push(Ta(A,g.zo(t,"offlineVideoStreams")));v.push(Ga(A,h,"transfer"));return g.hQ.all(v)}),3);
case 3:if(!l){Y.lq(4);break}return g.O(Y,BOx(t),4);case 4:rL({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:t,le:h,offlineModeType:(V=C)==null?void 0:V.offlineModeType}),g.uC(Y)}})},Dzk=function(W,e,l,K){if(!W.action.entityKey)throw Error("entityKey is missing.");
var t=g.ny(W.action.entityKey);t={entityType:t.OR,entityId:t.entityId,offlineOrchestrationActionType:W.action.actionType,orchestrationAction:{orchestrationActionId:W.actionId}};e&&(t.offlineOrchestrationActionResult=e.status,t.isRetryable=l?!1:e.L,e.X&&(t.offlineOrchestrationFailureReason=L8_(e.X,t.isRetryable)));var a,r;if((a=W.action.actionMetadata)==null?0:(r=a.offlineLoggingData)==null?0:r.offlineModeType)t.offlineModeType=W.action.actionMetadata.offlineLoggingData.offlineModeType;K&&(t.additionalOrchestrationActions=
K.map(function(b){return{orchestrationActionId:b.actionId}}));
return t},L8_=function(W,e){return W!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||e?W==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&e?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":W:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},vAJ=function(W,e){var l={offlineOrchestrationContext:Dzk(W)};
e=jRv(e,l);eu_(Wzp(),e,W.rootActionId)},JwK=function(W,e,l,K){K=K===void 0?[]:K;
e={offlineOrchestrationContext:Dzk(W,e,l,K)};e=jRv(3,e);eu_(Wzp(),e,W.rootActionId)},EAn=function(){this.actions=[]},HRx=function(W,e){e=g.u(e);
for(var l=e.next();!l.done;l=e.next())l=l.value,vAJ(l,1),W.actions.push(l);W.actions.sort(W.L)},PMJ=function(W,e){if(e)for(var l=0;l<W.actions.length;l++)if(e==="!*$_ALL_ENTITIES_!*$"&&W.actions[l].actionId!==e||e!=="!*$_ALL_ENTITIES_!*$"&&W.actions[l].rootActionId===e&&W.actions[l].actionId!==e)W.actions.splice(l,1),l--},qEt=function(W,e){W=g.u(W.actions);
for(var l=W.next();!l.done;l=W.next())if(l.value.actionId===e)return!0;return!1},Ew=function(W,e,l,K,t){g.H.call(this);
var a=this;this.K=W;this.Zm=e;this.KP=l;this.B=K;this.OT=t;this.L=new EAn;this.V=new g.yF;this.X=new g.IP(function(){a.retry()});
this.N=NaN;this.C=!1;this.Xi={wDg:function(){return a.L},
DT:function(){return a.V},
Mxb:function(){return a.X},
retry:function(){return a.retry()}};
g.P(this,this.X);this.T=this.K.observe(this.ET.bind(this))},TO2=function(W,e,l,K,t){var a;
return g.L(function(r){if(r.L==1)return a=new Ew(W,e,l,K,t),g.O(r,f$x(a),2);GP3(a);return r.return(a)})},GP3=function(W){var e=W.L.actions[0];
return W.J?((e==null?void 0:e.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&W.J[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(W.C=!0),Promise.resolve()):xzx(W)},xzx=function(W){var e,l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V;
return g.L(function(Y){switch(Y.L){case 1:if(W.J)throw Error("Already processing an action");if(W.qg())return Y.return();e=W.L.actions.shift();CP2(W.KP,!e);if(e===void 0)return Y.return();e.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&e.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&PMJ(W.L,e.actionId);l="";e.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&e.rootActionId===e.actionId&&(l=e.actionId);K=[e];W.J=K;if(t=W.Zm[e.entityType]){Y.lq(2);break}W.J=
void 0;return g.O(Y,xzx(W),3);case 3:return Y.return();case 2:a=g.u(K);for(r=a.next();!r.done;r=a.next())b=r.value,vAJ(b,2);g.cf(Y,4,5);return g.O(Y,kPx(t,K.map(function(A){return A.action})),7);
case 7:M=Y.K,w=g.u(K),U=w.next();case 8:if(U.done){Y.lq(10);break}C=U.value;Q=M.get(C.action);return g.O(Y,I$2(W,C,Q),9);case 9:U=w.next();Y.lq(8);break;case 10:PMJ(W.L,l);case 5:g.gQ(Y);W.J=void 0;g.VV(Y,6);break;case 4:return d=g.oG(Y),lQ("Orchestration error",d),g.cf(Y,12),g.O(Y,yws(W,K),14);case 14:g.hm(Y,5);break;case 12:N=g.oG(Y);lQ("Orchestration retry error",N);S=g.u(K);for(h=S.next();!h.done;h=S.next())V=h.value,V.retryScheduleIndex<3&&HRx(W.L,[V]);Y.lq(5);break;case 6:return g.O(Y,xzx(W),
0)}})},I$2=function(W,e,l){var K,t,a,r,b,M,w,U,C,Q,d,N;
return g.L(function(S){switch(S.L){case 1:K=e.retryScheduleIndex+2===3;if(l.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){S.lq(2);break}if(l.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){S.lq(0);break}JwK(e,l,K);if(l.L&&e.retryScheduleIndex+1<3)return g.O(S,yws(W,[e]),0);a=((t=l)==null?0:t.K)?l.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";r={entityKey:e.action.entityKey,failureReason:a};b=void 0;g.nn(W.OT)?b="mainVideoDownloadStateEntity":g.vZ(W.OT)&&(b="musicTrackDownloadMetadataEntity");
if(!b||!l.downloadState){S.lq(7);break}M=g.ny(e.action.entityKey).entityId;return g.O(S,wL(M,b,W.K,l.downloadState),7);case 7:Kd(W.B,r);if(l.downloadState==="DOWNLOAD_STATE_FAILED"&&W.OT.W("html5_auto_retry_failed_pde_actions")){S.lq(0);break}lQ("Orchestration result is not retryable, deleting action");return g.O(S,A0J(W.K,RI(e).key),0);case 2:w=void 0;try{w=(U=l.J)==null?void 0:U.map(function(h){return W.createAction(h,e)})}catch(h){return JwK(e,l,K),C={entityKey:e.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Kd(W.B,C),lQ("Orchestration subactions creation error",h),S.return()}JwK(e,l,K,w);if(!w){S.lq(12);break}Q=w.map(function(h){return RI(h)});
d=0;case 13:if(!(d<w.length)||W.C){S.lq(15);break}return g.O(S,yo(W.K,{mode:"readwrite",Gw:!0},function(h){var V=[];V.push(hTs(h,Q.slice(d,d+10),"offlineOrchestrationActionWrapperEntity"));return g.hQ.all(V)}),16);
case 16:d+=10;S.lq(13);break;case 15:if(W.C)return W.C=!1,S.return();case 12:return N=RI(e),g.O(S,A0J(W.K,N.key),17);case 17:vAJ(e,4),g.uC(S)}})},XT_=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d;
return g.L(function(N){l=[];K=Infinity;t=4E3;a=g.u(e);for(r=a.next();!r.done;r=a.next())b=r.value,M=Number(b.enqueueTimeSec),w=nAt(M),U=b.retryScheduleIndex,C=U!=null&&U>0,w>0&&C?(K=Math.min(K,M),t=Math.min(w,t)):l.push(b);isFinite(K)&&(!W.X.isActive()||K<W.N)&&(W.N=K,W.X.start(t));W.V.qy()||(Q=l.length,l=l.filter(function(S){var h;S=((h=S.actionProto)==null?void 0:h.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!zR_.includes(S)}),d=l.length<Q,!W.X.isActive()&&d&&W.X.start(1));
l.length>0&&mzp(W,l);return g.O(N,GP3(W),0)})},j3x=function(W){var e,l,K,t,a,r,b;
return g.L(function(M){if(M.L==1)return g.O(M,WMv(W),2);e=M.K;l=[];K=g.u(e);for(t=K.next();!t.done;t=K.next())a=t.value,r=g.ny(a.key),b=r.entityId,qEt(W.L,b)||l.push(a);return g.O(M,XT_(W,l),0)})},nAt=function(W){W=W*1E3-Date.now();
return W>4E3?4E3:W},yws=function(W,e){var l,K,t;
return g.L(function(a){l=g.u(e);for(K=l.next();!K.done;K=l.next()){t=K.value;var r=void 0,b=void 0,M=((b=t.action)==null?void 0:(r=b.actionMetadata)==null?void 0:r.retryScheduleIntervalsInSeconds)||[1,2,4];r=1;t.retryScheduleIndex<M.length&&(r=M[t.retryScheduleIndex]);t.L=r*1E3+Date.now();t.retryScheduleIndex++}return g.O(a,e5n(W,e),0)})},f$x=function(W){var e;
return g.L(function(l){if(l.L==1)return g.O(l,mC(W.K,"offlineOrchestrationActionWrapperEntity"),2);e=l.K;return g.O(l,XT_(W,e),0)})},mzp=function(W,e){e.length!==0&&e.forEach(function(l){l=Nm(l);
l.retryScheduleIndex<3&&HRx(W.L,[l])})},WMv=function(W,e){var l;
return g.L(function(K){if(K.L==1)return g.O(K,mC(W.K,"offlineOrchestrationActionWrapperEntity",e),2);l=K.K;return K.return(l.filter(P2C))})},e5n=function(W,e){if(e.length===0)return Promise.resolve([]);
e=e.map(function(l){return RI(l)});
return Ol3(W.K,e)},liv=function(W){this.vx=W;
this.L=void 0},iGJ=function(W,e){var l,K,t,a;
return g.L(function(r){l=e.videoId;K=!0;if(e.captionTracks.length)t=ug3(e),W.L=new g.wa(W.vx,e,t);else if(e.PV)a=g.CUW(e),W.L=new g.Cf(W.vx,e.PV,l,a,e.Gc,e.eventId),K=e.Gc;else return r.return();return r.return(new Promise(function(b){var M;(M=W.L)==null||M.PN({zf:function(){return g.L(function(w){if(w.L==1)return g.O(w,W.zf(l,K),2);b();g.uC(w)})},
T2:function(){}})}))})},KM2=function(W){var e;
return g.L(function(l){if(l.L==1)return g.O(l,x4J(W),2);e=l.K;return l.return(!!e&&e.length>0)})},H3=function(W){g.H.call(this);
this.L=W;this.K=this.L.observe(this.X.bind(this))},tdJ=function(W,e){var l,K,t,a,r,b,M;
return g.L(function(w){switch(w.L){case 1:if(e.length===0)return w.return([]);l=e.map(function(U){return g.zo(U,"transfer")});
return g.O(w,mC(W.L,"transfer",l),2);case 2:K=w.K;t=K.filter(P2C).map(function(U){return g.ny(U.key).entityId});
a=e.filter(function(U){return t.indexOf(U)===-1});
if(a.length===0)return w.return([]);r=g.u(a);b=r.next();case 3:if(b.done){w.lq(5);break}M=b.value;return g.O(w,BOx(M),4);case 4:b=r.next();w.lq(3);break;case 5:return w.return(a)}})},kq3=function(W,e,l,K,t,a){var r,b,M;
return g.L(function(w){r="STREAM_TYPE_UNKNOWN";l.video&&l.audio?(r="STREAM_TYPE_AUDIO_AND_VIDEO",lQ("unexpected stream type")):l.video&&!l.audio?r="STREAM_TYPE_VIDEO":!l.video&&l.audio&&(r="STREAM_TYPE_AUDIO");b=g.zo(e,"offlineVideoStreams");M={numBytesDownloaded:t.toFixed(),numTotalBytes:a.toFixed(),streamType:r,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(K),itag:r==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(l.itag):void 0};return g.O(w,yo(W,{mode:"readwrite",Gw:!0},
function(U){var C=P5(U,b,"offlineVideoStreams"),Q=P5(U,g.zo(e,"transfer"),"transfer");return g.hQ.all([C,Q]).then(function(d){d=g.u(d);var N=d.next().value;d=d.next().value;if(!d)return Ta(U,b).then(function(){});
var S=ai3(N);N=rc_(N,K,M,b);var h=Ga(U,N,"offlineVideoStreams");ai3(N)>S&&(d.lastProgressTimeMs=Date.now().toString());S=[h];d.offlineVideoStreams||(d.offlineVideoStreams=[]);d.offlineVideoStreams.indexOf(b)===-1&&(d.offlineVideoStreams.push(b),S.push(Ga(U,d,"transfer")));return g.hQ.all(S)})}),0)})},bGn=function(W,e){var l,K,t,a,r;
return g.L(function(b){if(b.L==1)return l=g.zo(e,"offlineVideoStreams"),g.O(b,za(W,l,"offlineVideoStreams"),2);K=b.K;if(!K||!K.streamsProgress)return b.return();t=g.u(K.streamsProgress);for(a=t.next();!a.done;a=t.next())r=a.value,r.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",r.numTotalBytes!==r.numBytesDownloaded&&(r.numBytesDownloaded=r.numTotalBytes);return g.O(b,nE(W,K,"offlineVideoStreams"),0)})},rc_=function(W,e,l,K){if(W&&W.streamsProgress){K=W;
a:{e=e.itag+";"+e.xtags;for(var t=W.streamsProgress,a=0;a<t.length;a++){var r=JSON.parse(t[a].formatStreamBytes);if(r.itag+";"+r.xtags===e){t[a]=l;l=t;break a}}t.push(l);l=t}K.streamsProgress=l}else W={key:K,streamsProgress:[l]};return W},ai3=function(W){if(W==null?0:W.streamsProgress){var e=0;
W=W.streamsProgress;for(var l=0;l<W.length;l++){var K=W[l];isNaN(Number(K.numBytesDownloaded))?lQ("stream progress bytes number invalid"):e+=Number(K.numBytesDownloaded)}return e}return 0},$6K=function(W,e,l,K){g.H.call(this);
var t=this;this.K=W;this.api=e;this.nP=l;this.ET=K;this.V=new g.yF;this.J=new g.IP(function(){t.L&&t.L.transferState==="TRANSFER_STATE_TRANSFERRING"&&t.V.qy()&&((t.L.transferRetryCount||0)<3?J_(t.B,t.C,!1,!1):v3(t.B,t.C.videoDetails.videoId),t.S$("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.KP=this.Hx=0;this.T=this.N=!1;this.xS=g.$H(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.GT=new g.DF(this);this.Xi={gYx:function(){return t.J},
VxT:function(){return t.ET},
DT:function(){return t.V}};
this.Zm=this.K.observe(this.H5.bind(this));this.B=new SE2(e,this);this.jV=new liv(e);this.Rr=new H3(this.K);this.Wx=this.V.listen("publicytnetworkstatus-online",this.E9.bind(this));this.Bx=this.V.listen("publicytnetworkstatus-offline",this.Ow2.bind(this));this.T=this.api.U().W("html5_less_transfer_processing_logs");g.P(this,this.GT);this.GT.G(e,"offlinetransferpause",this.LsN);g.nn(this.api.U())?this.X="mainVideoDownloadStateEntity":g.vZ(this.api.U())&&(this.X="musicTrackDownloadMetadataEntity")},
MdJ=function(W){return g.L(function(e){if(e.L==1)e=g.O(e,GwU(),2);
else{var l=W.Rr;var K=g.Vc();K=Object.keys(K);l=tdJ(l,K);e=g.O(e,l,0)}return e})},qm=function(W,e){e=e===void 0?!1:e;
var l;return g.L(function(K){if(K.L==1){if(W.L)throw Error("Already downloading a video");W.KP=0;W.N=!1;return g.O(K,wut(W),2)}return K.L!=4?(l=K.K,QR3(W.nP,!l),l&&W.V.qy()?e?g.O(K,new Promise(function(t){g.CI(t,1E3)}),4):K.lq(4):(!l&&W.L&&P3(W),K.lq(0))):g.O(K,U6n(W,l),0)})},CT2=function(W){return g.L(function(e){if(e.L==1)return W.C?g.O(e,v3(W.B,W.C.videoDetails.videoId),3):e.lq(0);
P3(W);g.uC(e)})},Q3k=function(W,e){var l,K,t;
return g.L(function(a){switch(a.L){case 1:return g.cf(a,2),(l=!!e.captionTracks.length||!!e.PV)?g.O(a,KM2(e.videoId),4):a.return();case 4:return(K=a.K)?a.return():g.O(a,iGJ(W.jV,e),5);case 5:g.hm(a,0);break;case 2:t=g.oG(a),lQ("Caption downloading error",t,e.cotn),g.uC(a)}})},U6n=function(W,e){var l,K,t,a,r,b;
return g.L(function(M){switch(M.L){case 1:if(W.N)return M.return();W.N=!0;W.L=e;l=g.ny(W.L.key);K=l.entityId;t=void 0;if(W.L.transferState==="TRANSFER_STATE_TRANSFERRING")return g.O(M,fd(W,K),7);if(W.L.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||W.L.transferRetryCount||W.L.hasLoggedFirstStarted){M.lq(3);break}return g.O(M,fd(W,K),5);case 5:return t=M.K,W.L.hasLoggedFirstStarted=!0,g.O(M,d6x(W),6);case 6:dlv({videoId:K,le:W.L,offlineModeType:t},void 0,void 0,!0);M.lq(3);break;case 7:t=M.K,
rL({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:K,le:W.L,offlineModeType:t});case 3:return g.O(M,NwJ(W),8);case 8:return a=null,g.cf(M,9),g.O(M,R5J(W,e),11);case 11:a=M.K;W.C=a;g.hm(M,10);break;case 9:return r=g.oG(M),lQ("error getting player response",r,e.cotn),g.O(M,W.S$("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return M.return();case 10:return b=BCk(W.api.U(),e.cotn,a),g.O(M,Q3k(W,b),13);case 13:return g.O(M,hRJ(b.videoId),
14);case 14:b.Nh=M.K,VVK(W.B,b,e.maximumDownloadQuality),W.J.start(108E5),g.uC(M)}})},wut=function(W){var e,l;
return g.L(function(K){if(K.L==1)return g.O(K,mC(W.K,"transfer"),2);e=K.K;l=e.filter(uup).sort(ccv);return l.length===0?K.return():K.return(l[0])})},NwJ=function(W){var e,l,K;
return g.L(function(t){if(t.L==1){if(!W.L)return G2(W,"onTransferStart"),t.return();W.J.start(108E5);return g.O(t,T2(W,"TRANSFER_STATE_TRANSFERRING"),2)}e=W.L;return(K=((l=e)==null?0:l.key)?g.ny(e.key).entityId:"")&&W.X?g.O(t,wL(K,W.X,W.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):t.lq(0)})},gAK=function(W){var e,l,K,t;
g.L(function(a){switch(a.L){case 1:if(!W.L){G2(W,"onTransferPausedByUser");a.lq(2);break}e=W.L;W.J.stop();return g.O(a,T2(W,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:K=((l=e)==null?0:l.key)?g.ny(e.key).entityId:"";if(!K||!W.X){a.lq(4);break}return g.O(a,wL(K,W.X,W.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.O(a,fd(W,K),6);case 6:t=a.K,NCC({videoId:K,le:e,offlineModeType:t});case 2:P3(W),qm(W),g.uC(a)}})},pTK=function(W){var e,l,K;
g.L(function(t){if(t.L==1){if(!W.L)return G2(W,"onTransferPausedByNetwork"),t.return();W.J.stop();return g.O(t,T2(W,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(t.L!=3)return e=W.L,(K=((l=e)==null?0:l.key)?g.ny(e.key).entityId:"")&&W.X?g.O(t,wL(K,W.X,W.K,"DOWNLOAD_STATE_PAUSED"),3):t.lq(3);P3(W);g.uC(t)})},SY2=function(W){var e,l,K,t,a;
g.L(function(r){switch(r.L){case 1:if(!W.L)return G2(W,"onTransferComplete"),r.return();e=W.L;W.J.stop();if(!e||!W.C){r.lq(2);break}l=BCk(W.api.U(),e.cotn,W.C);return g.O(r,Q3k(W,l),2);case 2:return g.O(r,T2(W,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:t=((K=e)==null?0:K.key)?g.ny(e.key).entityId:"";if(!t||!W.X){r.lq(5);break}return g.O(r,wL(t,W.X,W.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.O(r,bGn(W.K,t),7);case 7:return g.O(r,fd(W,t),8);case 8:a=r.K,rL({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:t,le:e,offlineModeType:a}),P3(W),qm(W),g.uC(r)}})},Bwn=function(W,e,l){var K,t;
g.L(function(a){switch(a.L){case 1:if(!W.L)return G2(W,"onTransferProgress: "+e),a.return();if(W.L.transferState==="TRANSFER_STATE_TRANSFERRING"){a.lq(2);break}return g.O(a,NwJ(W),2);case 2:K=Date.now();if(!(K-W.Hx>1E3)){a.lq(4);break}W.Hx=K;return g.O(a,kq3(W.K,l.videoId,l.K,l.ZS,l.bytesDownloaded,l.L),5);case 5:if(W.T&&!(W.T&&K-W.KP>W.xS)){a.lq(4);break}W.KP=K;return g.O(a,fd(W,e),7);case 7:t=a.K,dlv({videoId:e,le:W.L,offlineModeType:t},l.bytesDownloaded,l.L);case 4:W.J.start(108E5),g.uC(a)}})},
h5J=function(W){var e=(W.L.transferRetryCount||0)<3;
e&&(W=W.L,W.transferRetryCount=(W.transferRetryCount||0)+1);return e},o0z=function(W,e){e=e===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":e;
var l,K,t,a;return g.L(function(r){if(r.L==1)return W.L||G2(W,"setTransferToFailed: "+e),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e==="TRANSFER_FAILURE_REASON_NETWORK"?l="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":e==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.O(r,T2(W,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",e),2);if(r.L!=3)return Kd(W.ET,{entityKey:(K=W.L)==null?void 0:K.key,failureReason:l}),
t=W.L?g.ny(W.L.key).entityId:"",g.O(r,fd(W,t),3);a=r.K;var b={videoId:t,le:W.L,offlineModeType:a},M=e,w={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};M&&(w.transferFailureReason=M,w.failureReason=RuC(M));rL(w,b);g.uC(r)})},T2=function(W,e,l,K){var t;
return g.L(function(a){if(a.L==1){if(!W.L)return G2(W,"saveTransferState: "+e),a.return();W.L.transferState=e;W.L.failureReason=K;g.cf(a,2);return g.O(a,d6x(W,function(r){return l?qY(r,"offlineVideoStreams",W.L.offlineVideoStreams).then(function(b){for(var M=g.u(b),w=M.next();!w.done;w=M.next())if((w=w.value)&&w.streamsProgress){w=g.u(w.streamsProgress);for(var U=w.next();!U.done;U=w.next())U.value.streamState=l}return hTs(r,b.filter(function(C){return!!C}),"offlineVideoStreams")}):g.hQ.resolve(void 0)}),
4)}if(a.L!=2)return g.hm(a,0);
t=g.oG(a);return t instanceof g.dE&&t.type==="QUOTA_EXCEEDED"?g.O(a,W.S$("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):a.lq(0)})},d6x=function(W,e){var l;
return g.L(function(K){if(!W.L)return K.return();l=W.L;return g.O(K,yo(W.K,{mode:"readwrite",Gw:!0},function(t){var a=[Ga(t,l,"transfer")];e&&a.push(e(t));return g.hQ.all(a)}),0)})},P3=function(W){W.L=void 0;
W.C=void 0;W.J.stop()},R5J=function(W,e){var l,K,t,a,r;
return g.L(function(b){if(b.L==1)return l=g.ny(e.key),K=l.entityId,t=g.zo(K,"playbackData"),g.O(b,za(W.K,t,"playbackData"),2);a=b.K;if((r=a)==null?0:r.playerResponseJson)return b.return(JSON.parse(a.playerResponseJson));throw Error("No PlayerResponse found");})},G2=function(W,e){W.api.AS("woffle",{mcte:e});
lQ("missing current transfer entity.")},fd=function(W,e){var l,K,t;
return g.L(function(a){if(a.L==1)return g.O(a,za(W.K,g.zo(e,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);l=a.K;return a.return((t=(K=l)==null?void 0:K.offlineModeType)!=null?t:void 0)})},uup=function(W){return g0K[W.transferState]!==void 0},ccv=function(W,e){var l=g0K[W.transferState],K=g0K[e.transferState];
return l!==K?l-K:Number(W.enqueuedTimestampMs)-Number(e.enqueuedTimestampMs)},x4=function(W,e){var l=this;
this.OT=W;this.api=e;this.V=new g.yF;this.C=new g.gr;this.Xi={yW:function(){return l.X.Xi.yW()},
DT:function(){return l.V},
RtN:function(){return l.X},
FQ:function(){return l.FQ()},
ev:function(){return l.ev()},
fk:function(){return l.fk()},
XP:function(){return l.XP()},
AM:function(){return l.AM()},
Lx:function(K){return l.Lx(K)}};
this.X=new MDJ(function(){return puJ(l)},function(){l.fk()},this.api.xW(),this.api.W.bind(this.api));
this.L=new iQ(this.api);w0p(this.X)},puJ=function(W){return g.L(function(e){W.api.hS("onOrchestrationBecameLeader");
return g.O(e,W.ev(),0)})},s3C=function(W){var e,l;
return g.L(function(K){if(K.L==1)return g.O(K,Xm(),2);if(K.L!=3){e=K.K;if(!e)return lQ("PES is undefined"),K.return();W.K=new $6K(e,W.api,W.X,W.L);l=W.jp(e);return g.O(K,TO2(e,l,W.X,W.L,W.OT),3)}W.B=K.K;return g.O(K,VdC(W),0)})},VdC=function(W){var e;
return g.L(function(l){switch(l.L){case 1:if(!W.K)return lQ("transferManager is undefined"),l.return();if(W.K.L){l.lq(2);break}return g.O(l,qm(W.K),2);case 2:if(!W.OT.W("woffle_enable_main_downloads_library")){l.lq(4);break}return g.O(l,W.sJ(),4);case 4:if(!W.OT.W("html5_offline_playback_position_sync")){l.lq(6);break}return g.O(l,W.Es(),7);case 7:return g.O(l,W.Lx(864E5),6);case 6:return g.O(l,W.refreshAllStaleEntities(43200,!0),9);case 9:return g.O(l,W.Rp(),10);case 10:if(!W.OT.W("html5_retry_downloads_for_expiration")){l.lq(11);
break}return g.O(l,W.AM(),11);case 11:return W.N=g.QR(function(){W.refreshAllStaleEntities(43200,!0);W.Rp()},9E5),g.X7(g.jW(),function(){return W.XP()}),g.O(l,Xm(),13);
case 13:return e=l.K,g.O(l,$lJ(e),14);case 14:Uln(W.X),g.uC(l)}})},ZGv=function(){var W,e,l,K,t,a;
return g.L(function(r){switch(r.L){case 1:return g.O(r,Xm(),2);case 2:W=r.K;if(!W)return r.return([]);e=Date.now()/1E3;return g.O(r,mC(W,"offlineVideoPolicy"),3);case 3:l=r.K,K=g.u(l),t=K.next();case 4:if(t.done){r.lq(6);break}a=t.value;if(!(a.expirationTimestamp&&Number(a.expirationTimestamp)<e)){r.lq(5);break}a.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";a.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.O(r,nE(W,a,"offlineVideoPolicy"),5);
case 5:t=K.next();r.lq(4);break;case 6:return r.return(l.map(function(b){return b.key}))}})},II=function(W,e,l,K,t){var a,r,b;
return g.L(function(M){if(M.L==1)return g.O(M,Xm(),2);a=M.K;if(!a)return M.return([]);r=e.map(function(w){var U=g.zo(w,l);U={actionType:K,entityKey:U,actionMetadata:Object.assign({},hu2(),t)};K!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(U.actionMetadata.priority=0);w=new dL(l,w,U);return RI(w)});
b=Ol3(a,r);w0p(W.X);return M.return(b)})},FM2=function(W,e,l,K){var t,a,r,b,M,w,U,C;
return g.L(function(Q){switch(Q.L){case 1:t=[],a=g.u(e),r=a.next();case 2:if(r.done){Q.lq(4);break}b=r.value;if(b.upToDate||l&&!b.shouldAutoSyncMetadata||!b.playlistId){Q.lq(3);break}M={};switch(K){case "mainPlaylistEntity":w={nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:l};M={mainPlaylistEntityActionMetadata:w};break;case "musicPlaylist":U={autoSync:l},M={musicPlaylistEntityActionMetadata:U}}return g.O(Q,II(W,[b.playlistId],K,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M),6);case 6:(C=
Q.K)&&t.push.apply(t,g.B(C));case 3:r=a.next();Q.lq(2);break;case 4:return Q.return(t)}})},YYx=function(W,e){var l;
return g.L(function(K){return e.length?(l=hu2(),g.PR(l,Ld,{isEnqueuedForExpiredStreamUrlRefetch:!0}),W.api.AS("qrd",{v:e.length}),K.return(II(W,e,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l))):K.return([])})},OGt=function(W,e,l){this.L=W;
this.OT=e;this.X=l},D6t=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y;
return g.L(function(A){switch(A.L){case 1:return l=k4(e),K=g.ny(e.entityKey),t=K.entityId,a=[],g.cf(A,2),g.O(A,Acv(W,t),4);case 4:a=A.K;if(!(W.OT.W("woffle_enable_main_downloads_library")&&((r=a)==null?0:r.length))){A.lq(5);break}return g.O(A,v3z(W.L,[e.entityKey]),5);case 5:g.hm(A,3);break;case 2:return b=g.oG(A),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.dE&&b.type==="QUOTA_EXCEEDED"?(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):lQ("Playlist add error"),A.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,M,w));case 3:U=[];if(!W.OT.W("html5_offline_prevent_redownload_downloaded_video")){A.lq(7);break}return g.O(A,SQ3(W.L,"mainVideoEntity",a),8);case 8:a=A.K;case 7:if((C=a)==null?0:C.length)for(Q=g.u(a),d=Q.next();!d.done;d=Q.next())if(N=d.value,S=N.offlineVideoData,h=void 0,(h=S)==null?0:h.videoId)V=void 0,Y=Number(((V=e.actionMetadata)==null?void 0:V.priority)||
0)+1,U.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S.videoId,"mainVideoEntity",Y,yq,LM2(e,S,t)));return A.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,U))}})},Jcp=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU,rx,NK,p,Z,F,D,J,jl,KH,tm,E,Sl,rQ,kW,OJ,zE,Hv,ms,xW,IU,Py,dM,TN,wf,xz,PO,IE,Bm,UV,Yl,Ne,OB,qR,fA,oH,eQ,yf,t9,LR,ni;
return g.L(function(Qu){switch(Qu.L){case 1:return l=k4(e),K=e.entityKey,t=g.ny(K).entityId,a=[],r=!1,t==="!*$_ALL_ENTITIES_!*$"?(r=!0,g.O(Qu,mC(W.L,"mainPlaylistEntity"),5)):g.O(Qu,za(W.L,K,"mainPlaylistEntity"),4);case 4:(b=Qu.K)&&a.push(b);Qu.lq(3);break;case 5:a=Qu.K;case 3:if((M=a)==null||!M.length)return Qu.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));w=g.f(e.actionMetadata,v0k);C=(U=w)==null?void 0:U.nextAutoRefreshIntervalSeconds;d=(Q=w)==null?void 0:Q.autoSync;N=[];h=S=
!0;V=!1;if(!r&&d===!1){Qu.lq(6);break}g.cf(Qu,7);return g.O(Qu,mlK(0,!!d,!0,a),9);case 9:N=Qu.K;g.hm(Qu,8);break;case 7:Y=g.oG(Qu);if(!(Y instanceof Error&&Y.message==="No data")){Y instanceof Error&&Y.message==="Empty response body"&&lQ(Y.message);Qu.lq(8);break}return t==="!*$_ALL_ENTITIES_!*$"?g.O(Qu,Fzx(W.L,e,W.X,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.O(Qu,sRU(t,W.L,e,W.X),8);case 8:if(!N.length||!r&&N[0].playlistId!==t)return Qu.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l));case 6:if(r){A=[];v=g.u(N);for(q=v.next();!q.done;q=v.next())X=q.value,X.upToDate||d&&!X.shouldAutoSyncMetadata||!X.playlistId||(y={nextAutoRefreshIntervalSeconds:X.checkInSeconds,autoSync:d},A.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X.playlistId,"mainPlaylistEntity",0,yq,{mainPlaylistEntityActionMetadata:y})));return Qu.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,A))}N.length&&(iC=N[0],V=!!iC.upToDate,d&&(S=(aG=iC.shouldAutoSyncMetadata)!=null?aG:!0,h=(Wf=iC.shouldAutoSyncVideos)!=
null?Wf:!0,iC.checkInSeconds&&(C=iC.checkInSeconds)));if(V||!S)return Qu.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));G=[];m=a[0];if(!m.downloadState){c=void 0;Qu.lq(15);break}return g.O(Qu,za(W.L,m.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:c=Qu.K;case 15:return T=c,on=((Pf=T)==null?0:Pf.addedTimestampMillis)?String(T.addedTimestampMillis):void 0,g.cf(Qu,17),g.O(Qu,Acv(W,t,on,C),19);case 19:G=Qu.K;g.hm(Qu,18);break;case 17:dx=g.oG(Qu);if(!(dx instanceof Error&&
dx.message==="No data for playlist")){if(dx instanceof Error&&dx.message==="Empty response body for playlist")lQ(dx.message);else return pH="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jU="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dx instanceof g.dE&&dx.type==="QUOTA_EXCEEDED"&&(pH="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jU="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Qu.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,pH,jU));Qu.lq(18);
break}return g.O(Qu,sRU(t,W.L,e,W.X),18);case 18:if(!h)return Qu.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));rx=[];NK=new Map;if((p=G)==null?0:p.length)for(Z=g.u(G),F=Z.next();!F.done;F=Z.next())D=F.value,J=D.offlineVideoData,jl=void 0,((jl=J)==null?0:jl.videoId)&&NK.set(J.videoId,J);KH=new Map;tm=[];if((E=m)==null?0:(Sl=E.videos)==null?0:Sl.length)for(rQ=g.u(m.videos),kW=rQ.next();!kW.done;kW=rQ.next())if(OJ=kW.value,zE=JSON.parse(g.ny(OJ).entityId),Hv=zE.videoId)NK.has(Hv)?(KH.set(Hv,
NK.get(Hv)),NK.delete(Hv)):tm.push(Hv);xW=Number(((ms=e.actionMetadata)==null?void 0:ms.priority)||0)+1;IU=g.u(NK.entries());for(Py=IU.next();!Py.done;Py=IU.next())dM=Py.value,TN=g.u(dM),wf=TN.next().value,xz=TN.next().value,PO=wf,IE=xz,rx.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",PO,"mainVideoEntity",xW,yq,LM2(e,IE,t)));Bm=g.u(KH.entries());for(UV=Bm.next();!UV.done;UV=Bm.next())Yl=UV.value,Ne=g.u(Yl),OB=Ne.next().value,qR=Ne.next().value,fA=OB,oH=qR,rx.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
fA,"mainVideoEntity",xW,yq,LM2(e,oH,t)));eQ=g.u(tm);for(yf=eQ.next();!yf.done;yf=eQ.next())t9=yf.value,LR={playlistId:t},ni={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:LR},rx.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",t9,"mainVideoEntity",0,yq,ni));return Qu.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,rx))}})},E0K=function(W,e){var l,K,t,a;
return g.L(function(r){switch(r.L){case 1:return l=k4(e),g.cf(r,2),K=g.ny(e.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.O(r,Fzx(W.L,e,W.X,(t=e.actionMetadata)==null?void 0:(a=t.offlineLoggingData)==null?void 0:a.offlineDeleteReason),5):g.O(r,sRU(K,W.L,e,W.X),6);case 6:if(!W.OT.W("woffle_enable_main_downloads_library")){r.lq(5);break}return g.O(r,Jfp(W.L,e.entityKey),5);case 5:g.hm(r,3);break;case 2:return g.oG(r),r.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},Acv=function(W,e,l,K){var t,a,r,b,M,w,U;
return g.L(function(C){switch(C.L){case 1:return g.O(C,n3_([e]),2);case 2:return t=C.K,g.O(C,HGC(W,t[0],l,K),3);case 3:return a=C.K,r=a.mainPlaylistEntity,b=a.J2T,w=p0p(r,(M=b)==null?void 0:M.avatar),g.cf(C,4),g.O(C,c3(w),6);case 6:g.hm(C,5);break;case 4:U=g.oG(C),U instanceof Error&&U.message==="Failed to fetch"&&lQ(U.message);case 5:return C.return(t[0].videos)}})},HGC=function(W,e,l,K){var t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v;
return g.L(function(q){switch(q.L){case 1:t=Date.now().toString();l||(l=t);a=e.videos;r=e.playlistId;b=[];M=[];if(a)for(w=g.u(a),U=w.next();!U.done;U=w.next()){C=U.value;Q=C.offlineVideoData;if(!Q||!Q.videoId)throw lQ("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");d=Q.videoId;N={videoId:d,playlistId:r};S={id:g.zo(JSON.stringify(N),"mainPlaylistVideoEntity"),video:g.zo(d,"mainVideoEntity")};b.push(S);M.push(S.id)}V={key:g.zo(r,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:l,lastSyncedTimestampMillis:t};Y={key:g.zo(r,"mainPlaylistEntity"),playlistId:r,videos:M,title:e.title,thumbnailStyleData:PTt(e),visibility:qYs(e),downloadState:V.key};e.channel&&(A=e.channel.offlineChannelData,h=fit(g.zo(r,"ytMainChannelEntity"),A),Y.channelOwner=h.id);((v=Y)==null?0:v.entityMetadata)?(Y.entityMetadata.offlineLastModifiedTimestampSeconds=e.lastModifiedTimestamp,K&&(Y.entityMetadata.nextAutoRefreshIntervalSeconds=String(K))):Y&&(Y.entityMetadata={nextAutoRefreshIntervalSeconds:K?
String(K):void 0,offlineLastModifiedTimestampSeconds:e.lastModifiedTimestamp});g.cf(q,2);return g.O(q,yo(W.L,{mode:"readwrite",Gw:!0},function(X){var y=Ga(X,Y,"mainPlaylistEntity"),iC=Ga(X,V,"mainPlaylistDownloadStateEntity");y=[y,iC];iC=g.u(b);for(var aG=iC.next();!aG.done;aG=iC.next())y.push(Ga(X,aG.value,"mainPlaylistVideoEntity"));h&&y.push(Ga(X,h,"ytMainChannelEntity"));return g.hQ.all(y)}),4);
case 4:g.hm(q,3);break;case 2:throw g.oG(q),lQ("PES failure for playlist"),Error("PES failure for playlist");case 3:return q.return({mainPlaylistEntity:Y,J2T:h,ntS:b})}})},fit=function(W,e){return{id:W,
channelId:e.channelId,title:e.title,avatar:e.thumbnail}},PTt=function(W){var e=[],l=W.videos;
l&&l.length>0&&e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:l[0].offlineVideoData.thumbnail}}});if((W=W.additionalMetadadatas)&&W.length>0)for(W=g.u(W),l=W.next();!l.done;l=W.next()){var K=l.value.offlineBundleItemPlaylistData,t=void 0;l=(t=K)==null?void 0:t.style;t=void 0;K={collageThumbnail:{coverThumbnail:(t=K)==null?void 0:t.coverThumbnail}};switch(l){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:K});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:K});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:K});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:K})}}return e},qYs=function(W){switch(W.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},LM2=function(W,e,l){e={offlineVideoData:e,
playlistId:l};if(W=g.f(W.actionMetadata,v0k))e.maximumDownloadQuality=W.maximumDownloadQuality;return{mainVideoEntityActionMetadata:e}},Gq3=function(W,e,l){this.L=W;
this.OT=e;this.X=l},Iip=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N;
return g.L(function(S){switch(S.L){case 1:return l=k4(e),K=g.ny(e.entityKey),t=K.entityId,a=g.f(e.actionMetadata,nd),b=!((r=a)==null?0:r.playlistId),g.cf(S,2),g.O(S,TwK(W,t,void 0,(M=a)==null?void 0:M.offlineVideoData,b),4);case 4:g.hm(S,3);break;case 2:return w=g.oG(S),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.dE&&w.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
S.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,U,C));case 3:Q=1;Q=Number(((d=e.actionMetadata)==null?void 0:d.priority)||0)+1;var h=(h=g.f(e.actionMetadata,nd))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;N=Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t,"playbackData",Q,x62,h);return S.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,[N]))}})},yc_=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y;
return g.L(function(A){switch(A.L){case 1:return l=k4(e),K=g.ny(e.entityKey),t=K.entityId,g.O(A,za(W.L,e.entityKey,"mainVideoEntity"),2);case 2:a=A.K;if(!a){r=void 0;A.lq(3);break}return g.O(A,za(W.L,a.downloadState,"mainVideoDownloadStateEntity"),4);case 4:r=A.K;case 3:b=r;if(!a||!b)return A.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.cf(A,5);return g.O(A,TwK(W,t,b.addedTimestampMillis,(w=g.f(e.actionMetadata,nd))==null?void 0:w.offlineVideoData),7);case 7:U=1;U=Number(((C=
e.actionMetadata)==null?void 0:C.priority)||0)+1;M=Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t,"playbackData",U,x62);g.hm(A,6);break;case 5:Q=g.oG(A);if(!(Q instanceof Error&&Q.message==="No data")){if(Q instanceof Error&&Q.message==="Empty response body")lQ(Q.message);else return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.dE&&Q.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,d,N));A.lq(6);break}return g.O(A,h_(W.L,t),9);case 9:S=A.K;h=g.f(e.actionMetadata,nd);if(Y=(V=h)==null?void 0:V.playlistId)S.playlistId=Y;S.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.O(A,Sr(t,W.L,e,W.X,S),6);case 6:return A.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,M?[M]:void 0))}})},n0t=function(W,e){var l,K,t,a,r,b,M,w,U,C;
return g.L(function(Q){switch(Q.L){case 1:return l=k4(e),g.cf(Q,2),K=g.ny(e.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.O(Q,Fzx(W.L,e,W.X,(U=e.actionMetadata)==null?void 0:(C=U.offlineLoggingData)==null?void 0:C.offlineDeleteReason),5):g.O(Q,h_(W.L,K),6);case 6:t=Q.K;a=g.f(e.actionMetadata,nd);if(b=(r=a)==null?void 0:r.playlistId)t.playlistId=b;t.offlineDeleteReason=(M=e.actionMetadata)==null?void 0:(w=M.offlineLoggingData)==null?void 0:w.offlineDeleteReason;return g.O(Q,Sr(K,W.L,e,W.X,t),7);
case 7:if(!W.OT.W("woffle_enable_main_downloads_library")){Q.lq(5);break}return g.O(Q,Jfp(W.L,e.entityKey),5);case 5:g.hm(Q,3);break;case 2:return g.oG(Q),Q.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},TwK=function(W,e,l,K,t){var a,r,b,M,w,U;
return g.L(function(C){switch(C.L){case 1:if(a=K){C.lq(2);break}return g.O(C,yfC([e]),3);case 3:r=C.K,a=r[0];case 2:return g.O(C,z5_(W,a,l,t),4);case 4:b=C.K;M=b.mainVideoEntity;w=b.channelEntity;g.cf(C,5);var Q=Qq(M.thumbnail),d=Qq(w.avatar);return g.O(C,c3(Q.concat(d)),7);case 7:g.hm(C,0);break;case 5:U=g.oG(C),U instanceof Error&&U.message==="Failed to fetch"&&lQ(U.message),g.uC(C)}})},z5_=function(W,e,l,K){var t,a,r,b,M,w,U,C,Q,d,N,S,h;
return g.L(function(V){switch(V.L){case 1:l||(l=Date.now().toString());a=(t=e.channel)==null?void 0:t.offlineChannelData;r={id:g.zo(e.videoId,"ytMainChannelEntity"),channelId:a.channelId,title:a.title,avatar:a.thumbnail};b={key:g.zo(e.videoId,"mainVideoDownloadStateEntity"),playbackData:g.zo(e.videoId,"playbackData"),addedTimestampMillis:l,videoDownloadContextEntity:g.zo(e.videoId,"videoDownloadContextEntity")};M={key:g.zo(e.videoId,"videoPlaybackPositionEntity"),videoId:e.videoId,lastPlaybackPositionSeconds:"0"};
W.OT.W("html5_offline_playback_position_sync")&&(w={playbackPosition:M.key});U=g.zo(e.videoId,"mainVideoEntity");C={key:U,videoId:e.videoId,title:e.title,thumbnail:e.thumbnail,localizedStrings:{viewCount:e.shortViewCountText},userState:w,lengthSeconds:e.lengthSeconds?Number(e.lengthSeconds):void 0,publishedTimestampMillis:e.publishedTimestamp?(Number(e.publishedTimestamp)*1E3).toString():void 0,formattedDescription:e.description,owner:r.id,downloadState:b.key};if(!W.OT.W("woffle_enable_main_downloads_library")||
!K){V.lq(2);break}return g.O(V,DlU(W.L,[U]),3);case 3:if(N=V.K)Q=N.mainDownloadsLibraryEntity,d=N.mainDownloadsListEntity;case 2:return h=cfn,S={key:g.zo(e.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.PR(b,h,S),g.O(V,yo(W.L,{mode:"readwrite",Gw:!0},function(Y){var A=Ga(Y,r,"ytMainChannelEntity"),v=Ga(Y,b,"mainVideoDownloadStateEntity"),q=Ga(Y,C,"mainVideoEntity");A=[A,v,q];W.OT.W("html5_offline_playback_position_sync")&&(v=Ga(Y,M,"videoPlaybackPositionEntity"),
A.push(v));Q&&(v=Ga(Y,Q,"mainDownloadsLibraryEntity"),A.push(v));d&&(v=Ga(Y,d,"mainDownloadsListEntity"),A.push(v));S&&(Y=Ga(Y,S,"downloadStatusEntity"),A.push(Y));return g.hQ.all(A)}),4);
case 4:return V.return({mainVideoEntity:C,channelEntity:r})}})},m62=function(W,e,l){this.L=W;
this.OT=e;this.X=l},Wfs=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m;
return g.L(function(c){switch(c.L){case 1:return l=k4(e),K=[],g.O(c,JT.getInstance(),2);case 2:t=c.K;if(!t){c.lq(3);break}return g.O(c,t.get("sdois"),4);case 4:return a=c.K,g.O(c,(b=t)==null?void 0:b.get("lmqf"),5);case 5:r=c.K;case 3:g.cf(c,6);if(a===void 0)throw Error("prefStorage or opt-in state is undefined");M=[];if(a){c.lq(8);break}return g.O(c,LzK(W.L),9);case 9:M=c.K,M.reverse();case 8:if(!M.length){c.lq(10);break}w=g.u(M);U=w.next();case 11:if(U.done){c.lq(10);break}C=U.value;if(!C){c.lq(12);
break}Q=g.ny(C).entityId;return g.O(c,h_(W.L,Q),14);case 14:return d=c.K,d.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.O(c,Sr(Q,W.L,{entityKey:C,actionType:e.actionType},W.X,d),12);case 12:U=w.next();c.lq(11);break;case 10:return g.O(c,W8x(a,(N=r)!=null?N:"SD"),16);case 16:return S=c.K,g.O(c,YQJ(S),17);case 17:h=Afs(S);if(!W.OT.W("woffle_enable_main_downloads_library")){c.lq(18);break}if(a){c.lq(19);break}return g.O(c,Jfp(W.L,g.Z6),19);case 19:return g.O(c,v3z(W.L,[g.Z6]),18);
case 18:if((V=h)==null?0:V.length)for(Y=g.u(h),A=Y.next();!A.done;A=Y.next())if(q=v=A.value,X=q.actionType,y=q.entityKey,iC=q.actionMetadata,X&&y&&iC&&!g.f(iC,XuJ)){X==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(iC.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(aG=g.f(v.actionMetadata,nd))aG.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",v.actionMetadata=Object.assign({},v.actionMetadata,{mainVideoEntityActionMetadata:aG});K.push(v)}g.hm(c,7);break;
case 6:return Wf=g.oG(c),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Wf instanceof g.dE&&Wf.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),c.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,G,m));case 7:return c.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,K))}})},j_U=function(){x4.apply(this,arguments);
this.T="mainVideoEntity"},eqk=function(W,e,l){e=e===void 0?43200:e;
l=l===void 0?!0:l;var K=K===void 0?!1:K;var t,a,r;return g.L(function(b){switch(b.L){case 1:if(!W.V.qy())return b.return([]);t=[];g.cf(b,2);return g.O(b,mlK(e,l,K),4);case 4:t=b.K;g.hm(b,3);break;case 2:a=g.oG(b),a instanceof Error&&a.message==="No data"||a instanceof Error&&a.message==="Empty response body"&&lQ(a.message);case 3:return r=FM2(W,t,l,"mainPlaylistEntity"),b.return(r)}})},lxJ=function(W,e,l,K){K=K===void 0?!1:K;
var t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y;return g.L(function(A){switch(A.L){case 1:return t=[],g.O(A,X0C(),2);case 2:return(a=A.K)||K?g.O(A,jPn(e,l),3):A.return([]);case 3:r=A.K;if((b=r)==null||!b.length)return A.return([]);M={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};w=g.u(r);U=w.next();case 4:if(U.done){A.lq(6);break}Q=C=U.value;d=Q.actionType;N=Q.entityKey;S=Q.actionMetadata;if(!(d&&N&&S)||g.f(S,XuJ)){A.lq(5);break}d==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(S.offlineLoggingData=
M);h=g.ny(N);V=h.entityId;return g.O(A,II(W,[V],"mainVideoEntity",d,S),8);case 8:Y=A.K,t=t.concat(Y);case 5:U=w.next();A.lq(4);break;case 6:return A.return(t)}})},iit=function(W,e){this.L=W;
this.X=e},tXU=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V;
return g.L(function(Y){switch(Y.L){case 1:return l=k4(e),K=g.ny(e.entityKey),t=K.entityId,a=[],g.cf(Y,2),g.O(Y,Kf3(W,t),4);case 4:a=Y.K;if((r=a)==null||!r.length){Y.lq(5);break}return g.O(Y,fO_(W.L,e.entityKey),5);case 5:g.hm(Y,3);break;case 2:return b=g.oG(Y),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.dE&&b.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Y.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,M,w));case 3:return U=[],g.O(Y,SQ3(W.L,"musicTrack",a),7);case 7:a=Y.K;if(a.length)for(C=g.u(a),Q=C.next();!Q.done;Q=C.next())if(d=Q.value,N=d.offlineVideoData,S=void 0,(S=N)==null?0:S.videoId)h=void 0,V=Number(((h=e.actionMetadata)==null?void 0:h.priority)||0)+1,U.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",V,z2,Vq(e,N,t)));return Y.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,U))}})},
axJ=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU,rx,NK,p,Z,F,D,J,jl,KH,tm,E,Sl,rQ,kW,OJ,zE,Hv,ms,xW,IU,Py,dM,TN,wf,xz;
return g.L(function(PO){switch(PO.L){case 1:return l=k4(e),K=e.entityKey,t=g.ny(K).entityId,a=[],r=!1,t==="!*$_ALL_ENTITIES_!*$"?(r=!0,g.O(PO,mC(W.L,"musicAlbumRelease"),5)):g.O(PO,za(W.L,K,"musicAlbumRelease"),4);case 4:(b=PO.K)&&a.push(b);PO.lq(3);break;case 5:a=PO.K;case 3:if((M=a)==null||!M.length)return PO.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));if(r){w=[];U=g.u(a);for(C=U.next();!C.done;C=U.next())Q=C.value,d=g.ny(Q.id).entityId,w.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
d,"musicAlbumRelease",0,z2));return PO.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,w))}N=[];S=a[0];h=void 0;if(!S.downloadMetadata){PO.lq(6);break}return g.O(PO,za(W.L,S.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:V=PO.K,h=Number((A=(Y=V)==null?void 0:Y.addedTimestampMillis)!=null?A:"0")/1E3;case 6:return g.cf(PO,8),g.O(PO,Kf3(W,t,(v=h)==null?void 0:v.toString()),10);case 10:N=PO.K;g.hm(PO,9);break;case 8:q=g.oG(PO);if(!(q instanceof Error&&q.message===
"No data")){if(q instanceof Error&&q.message==="Empty response body")lQ(q.message);else return X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.dE&&q.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),PO.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,X,y));PO.lq(9);break}return g.O(PO,gL(t,"musicAlbumRelease",W.L,
e,W.X),9);case 9:iC=[];aG=new Map;if((Wf=N)==null?0:Wf.length)for(G=g.u(N),m=G.next();!m.done;m=G.next())c=m.value,T=c.offlineVideoData,Pf=void 0,((Pf=T)==null?0:Pf.videoId)&&aG.set(T.videoId,T);on=new Map;dx=[];if((pH=S)==null?0:(jU=pH.tracks)==null?0:jU.length)for(rx=g.u(S.tracks),NK=rx.next();!NK.done;NK=rx.next())if(p=NK.value,Z=g.ny(p).entityId)aG.has(Z)?(on.set(Z,aG.get(Z)),aG.delete(Z)):dx.push(Z);D=Number(((F=e.actionMetadata)==null?void 0:F.priority)||0)+1;J=g.u(aG.entries());for(jl=J.next();!jl.done;jl=
J.next())KH=jl.value,tm=g.u(KH),E=tm.next().value,Sl=tm.next().value,rQ=E,kW=Sl,iC.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",rQ,"musicTrack",D,z2,Vq(e,kW)));OJ=g.u(on.entries());for(zE=OJ.next();!zE.done;zE=OJ.next())Hv=zE.value,ms=g.u(Hv),xW=ms.next().value,IU=ms.next().value,Py=xW,dM=IU,iC.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Py,"musicTrack",D,z2,Vq(e,dM)));TN=g.u(dx);for(wf=TN.next();!wf.done;wf=TN.next())xz=wf.value,iC.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",xz,
"musicTrack",0,z2));return PO.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,iC))}})},rWs=function(W,e){var l,K;
return g.L(function(t){switch(t.L){case 1:return l=k4(e),g.cf(t,2),K=g.ny(e.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.O(t,pd(W.L,e,W.X),5):g.O(t,gL(K,"musicAlbumRelease",W.L,e,W.X),6);case 6:return g.O(t,G8K(W.L,e.entityKey),5);case 5:g.hm(t,3);break;case 2:return g.oG(t),t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},Kf3=function(W,e,l){var K,t,a;
return g.L(function(r){switch(r.L){case 1:return g.O(r,n3_([e]),2);case 2:return K=r.K,g.O(r,ksK(W,K[0],l),3);case 3:return t=r.K,a=Qq(t.thumbnailDetails),g.O(r,c3(a),4);case 4:return r.return(K[0].videos)}})},ksK=function(W,e,l){var K,t,a,r,b,M,w,U,C,Q,d,N,S,h;
return g.L(function(V){if(V.L==1){K=e.additionalMetadadatas;t=void 0;if(K&&K.length>0)for(a=g.u(K),r=a.next();!r.done;r=a.next())if(b=r.value,b.offlineMusicPlaylistData){t=b.offlineMusicPlaylistData;break}M=e.playlistId;w=TCx(e);U=w.Xc;C=w.EB;Q=l?(Number(l)*1E3).toString():Date.now().toString();d=e.lastModifiedTimestamp?(Number(e.lastModifiedTimestamp)*1E3).toString():"0";N={id:g.zo(M,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:C,lastModifiedTimestampMillis:d,addedTimestampMillis:Q,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};S={id:g.zo(M,"musicAlbumRelease"),title:e.title,audioPlaylistId:M,trackCount:e.totalVideoCount,tracks:U,downloadMetadata:N.id};t&&(S.thumbnailDetails=(h=t.albumHqThumbnail)!=null?h:t.albumArtistThumbnail,S.artistDisplayName=t.albumArtistDisplayName,S.releaseDate=t.albumReleaseDate,S.contentRating={explicitType:t.albumReleaseExplicitType},S.releaseType=t.albumReleaseType);return g.O(V,yo(W.L,{mode:"readwrite",Gw:!0},function(Y){var A=Ga(Y,S,"musicAlbumRelease");
Y=Ga(Y,N,"musicAlbumReleaseDownloadMetadataEntity");return g.hQ.all([A,Y])}),2)}return V.return(S)})},biU=function(W,e){this.L=W;
this.X=e},MXs=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V;
return g.L(function(Y){switch(Y.L){case 1:return l=k4(e),K=g.ny(e.entityKey),t=K.entityId,a=[],g.cf(Y,2),g.O(Y,$5x(W,t),4);case 4:a=Y.K;if((r=a)==null||!r.length){Y.lq(5);break}return g.O(Y,fO_(W.L,e.entityKey),5);case 5:g.hm(Y,3);break;case 2:return b=g.oG(Y),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.dE&&b.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Y.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,M,w));case 3:return U=[],g.O(Y,SQ3(W.L,"musicTrack",a),7);case 7:a=Y.K;if(a.length)for(C=g.u(a),Q=C.next();!Q.done;Q=C.next())if(d=Q.value,N=d.offlineVideoData,S=void 0,(S=N)==null?0:S.videoId)h=void 0,V=Number(((h=e.actionMetadata)==null?void 0:h.priority)||0)+1,U.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",V,mW,Vq(e,N,t)));return Y.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,U))}})},
wtp=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU,rx,NK,p,Z,F,D,J,jl,KH,tm,E,Sl,rQ,kW,OJ,zE,Hv,ms,xW,IU,Py,dM,TN,wf,xz,PO,IE,Bm,UV,Yl,Ne,OB,qR,fA,oH,eQ,yf;
return g.L(function(t9){switch(t9.L){case 1:return l=k4(e),K=e.entityKey,t=g.ny(K).entityId,a=[],r=!1,t==="!*$_ALL_ENTITIES_!*$"?(r=!0,g.O(t9,mC(W.L,"musicPlaylist"),5)):g.O(t9,za(W.L,K,"musicPlaylist"),4);case 4:(b=t9.K)&&a.push(b);t9.lq(3);break;case 5:a=t9.K;case 3:if((M=a)==null||!M.length)return t9.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));w=g.f(e.actionMetadata,xl3);C=(U=w)==null?void 0:U.autoSync;Q=[];N=d=!0;S=!1;h=void 0;if(!r&&C===!1){t9.lq(6);break}g.cf(t9,7);return g.O(t9,
eRv(0,!!C,!0,a),9);case 9:Q=t9.K;g.hm(t9,8);break;case 7:V=g.oG(t9);if(!(V instanceof Error&&V.message==="No data")){V instanceof Error&&V.message==="Empty response body"&&lQ(V.message);t9.lq(8);break}return t==="!*$_ALL_ENTITIES_!*$"?g.O(t9,pd(W.L,e,W.X),8):g.O(t9,gL(t,"musicPlaylist",W.L,e,W.X),8);case 8:if(!Q.length||!r&&Q[0].playlistId!==t)return t9.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));case 6:if(r){Y=[];A=g.u(Q);for(v=A.next();!v.done;v=A.next())q=v.value,q.upToDate||
C&&!q.shouldAutoSyncMetadata||!q.playlistId||(X={autoSync:C},Y.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q.playlistId,"musicPlaylist",0,mW,{musicPlaylistEntityActionMetadata:X})));return t9.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,Y))}Q.length&&(y=Q[0],S=!!y.upToDate,C&&(d=(iC=y.shouldAutoSyncMetadata)!=null?iC:!0,N=(aG=y.shouldAutoSyncVideos)!=null?aG:!0,y.checkInSeconds&&(h=y.checkInSeconds)));if(S||!d)return t9.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l));Wf=[];G=a[0];m=void 0;if(!G.downloadMetadata){t9.lq(15);break}return g.O(t9,za(W.L,G.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:c=t9.K,m=Number((Pf=(T=c)==null?void 0:T.addedTimestampMillis)!=null?Pf:"0")/1E3;case 15:return g.cf(t9,17),g.O(t9,$5x(W,t,(on=m)==null?void 0:on.toString(),h),19);case 19:Wf=t9.K;g.hm(t9,18);break;case 17:dx=g.oG(t9);if(!(dx instanceof Error&&dx.message==="No data")){if(dx instanceof Error&&dx.message==="Empty response body")lQ(dx.message);else return pH=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jU="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dx instanceof g.dE&&dx.type==="QUOTA_EXCEEDED"&&(pH="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jU="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),t9.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,pH,jU));t9.lq(18);break}return g.O(t9,gL(t,"musicPlaylist",W.L,e,W.X),18);case 18:if(!N)return t9.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l));rx=[];NK=new Map;if((p=Wf)==null?0:p.length)for(Z=g.u(Wf),F=Z.next();!F.done;F=Z.next())D=F.value,J=D.offlineVideoData,jl=void 0,((jl=J)==null?0:jl.videoId)&&NK.set(J.videoId,J);KH=new Map;tm=[];if((E=G)==null?0:(Sl=E.tracks)==null?0:Sl.length)for(rQ=g.u(G.tracks),kW=rQ.next();!kW.done;kW=rQ.next())if(OJ=kW.value,zE=g.ny(OJ).entityId)NK.has(zE)?(KH.set(zE,NK.get(zE)),NK.delete(zE)):tm.push(zE);ms=Number(((Hv=e.actionMetadata)==null?void 0:Hv.priority)||0)+1;xW=g.u(NK.entries());for(IU=xW.next();!IU.done;IU=
xW.next())Py=IU.value,dM=g.u(Py),TN=dM.next().value,wf=dM.next().value,xz=TN,PO=wf,rx.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",xz,"musicTrack",ms,mW,Vq(e,PO)));IE=g.u(KH.entries());for(Bm=IE.next();!Bm.done;Bm=IE.next())UV=Bm.value,Yl=g.u(UV),Ne=Yl.next().value,OB=Yl.next().value,qR=Ne,fA=OB,rx.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",qR,"musicTrack",ms,mW,Vq(e,fA)));oH=g.u(tm);for(eQ=oH.next();!eQ.done;eQ=oH.next())yf=eQ.value,rx.push(Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
yf,"musicTrack",0,mW));return t9.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,rx))}})},U5v=function(W,e){var l,K;
return g.L(function(t){switch(t.L){case 1:return l=k4(e),g.cf(t,2),K=g.ny(e.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.O(t,pd(W.L,e,W.X),5):g.O(t,gL(K,"musicPlaylist",W.L,e,W.X),6);case 6:return g.O(t,G8K(W.L,e.entityKey),5);case 5:g.hm(t,3);break;case 2:return g.oG(t),t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},$5x=function(W,e,l,K){var t,a,r;
return g.L(function(b){switch(b.L){case 1:return g.O(b,n3_([e]),2);case 2:return t=b.K,g.O(b,CaU(W,t[0],l,K),3);case 3:return a=b.K,r=Qq(a.thumbnailDetails),g.O(b,c3(r),4);case 4:return b.return(t[0].videos)}})},CaU=function(W,e,l,K){var t,a,r,b,M,w,U,C,Q;
return g.L(function(d){return d.L==1?(t=e.playlistId,a=TCx(e),r=a.Xc,b=a.EB,M=l?(Number(l)*1E3).toString():Date.now().toString(),w=e.lastModifiedTimestamp?(Number(e.lastModifiedTimestamp)*1E3).toString():"0",U={id:g.zo(t,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:b,lastModifiedTimestampMillis:w,addedTimestampMillis:M,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},C={id:g.zo(t,"musicPlaylist"),title:e.title,playlistId:t,thumbnailDetails:e.thumbnail,visibility:Q_k(e),trackCount:e.totalVideoCount,
tracks:r,downloadMetadata:U.id},K&&(((Q=C)==null?0:Q.entityMetadata)?C.entityMetadata.nextAutoRefreshIntervalSeconds=String(K):C&&(C.entityMetadata={nextAutoRefreshIntervalSeconds:String(K)})),g.O(d,yo(W.L,{mode:"readwrite",Gw:!0},function(N){var S=Ga(N,C,"musicPlaylist");N=Ga(N,U,"musicPlaylistDownloadMetadataEntity");return g.hQ.all([S,N])}),2)):d.return(C)})},Q_k=function(W){switch(W.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},d52=function(W,e){this.L=W;
this.X=e},cWJ=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N;
return g.L(function(S){switch(S.L){case 1:return l=k4(e),K=g.ny(e.entityKey),t=K.entityId,a=g.f(e.actionMetadata,N8v),g.cf(S,2),g.O(S,Rq_(W,t,void 0,(r=a)==null?void 0:r.track,(b=a)==null?void 0:b.albumRelease),4);case 4:if((M=a)==null?0:M.playlistId){S.lq(5);break}return g.O(S,fO_(W.L,e.entityKey),5);case 5:g.hm(S,3);break;case 2:return w=g.oG(S),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.dE&&w.type==="QUOTA_EXCEEDED"&&
(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,U,C));case 3:d=Number(((Q=e.actionMetadata)==null?void 0:Q.priority)||0)+1;var h=(h=g.f(e.actionMetadata,N8v))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;N=Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t,"playbackData",d,uTz,h);return S.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l,[N]))}})},S13=function(W,e){var l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h;
return g.L(function(V){switch(V.L){case 1:return l=k4(e),K=g.ny(e.entityKey),t=K.entityId,g.O(V,za(W.L,e.entityKey,"musicTrack"),2);case 2:a=V.K;if(!a){r=void 0;V.lq(3);break}return g.O(V,za(W.L,a.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:r=V.K;case 3:b=r;if(!a||!b)return V.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));w=g.f(e.actionMetadata,N8v);g.cf(V,5);return g.O(V,Rq_(W,t,b.addedTimestampMillis,(U=w)==null?void 0:U.track,(C=w)==null?void 0:C.albumRelease),
7);case 7:d=Number(((Q=e.actionMetadata)==null?void 0:Q.priority)||0)+1;M=Ow("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t,"playbackData",d,uTz);g.hm(V,6);break;case 5:N=g.oG(V);if(!(N instanceof Error&&N.message==="No data")){if(N instanceof Error&&N.message==="Empty response body")lQ(N.message);else return S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.dE&&N.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,S,h));V.lq(6);break}return g.O(V,oI(t,W.L,e,W.X),6);case 6:return V.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,M?[M]:void 0))}})},B8K=function(W,e){var l,K;
return g.L(function(t){switch(t.L){case 1:return l=k4(e),g.cf(t,2),K=g.ny(e.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.O(t,pd(W.L,e,W.X),5):g.O(t,oI(K,W.L,e,W.X),6);case 6:return g.O(t,G8K(W.L,e.entityKey),5);case 5:g.hm(t,3);break;case 2:return g.oG(t),t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new A_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},Rq_=function(W,e,l,K,t){var a,r,b,M,w,U;
return g.L(function(C){switch(C.L){case 1:if(a=K){C.lq(2);break}return g.O(C,yfC([e]),3);case 3:r=C.K,b=r[0],a=qQJ(b);case 2:return g.O(C,hqK(W,a,e,t,l),4);case 4:M=C.K;w=M.musicTrackEntity;U=M.x6;var Q=Qq(w.thumbnailDetails),d=[];U&&(d=Qq(U.thumbnailDetails));return g.O(C,c3(Q.concat(d)),0)}})},hqK=function(W,e,l,K,t){var a;
return g.L(function(r){return r.L==1?(t||(t=Date.now().toString()),a={id:g.zo(l,"musicTrackDownloadMetadataEntity"),playbackData:g.zo(l,"playbackData"),addedTimestampMillis:t,videoDownloadContextEntity:g.zo(l,"videoDownloadContextEntity")},K&&(e.albumRelease=K.id),g.O(r,yo(W.L,{mode:"readwrite",Gw:!0},function(b){var M=[],w=Ga(b,a,"musicTrackDownloadMetadataEntity");M.push(w);w=Ga(b,e,"musicTrack");M.push(w);K&&(b=Ga(b,K,"musicAlbumRelease"),M.push(b));return g.hQ.all(M)}),2)):r.L!=3?g.O(r,wL(l,"musicTrackDownloadMetadataEntity",
W.L,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):r.return({musicTrackEntity:e,
x6:K})})},X$=function(){x4.apply(this,arguments);
this.T="musicTrack"},oMK=function(W,e,l){e=e===void 0?43200:e;
l=l===void 0?!0:l;var K=K===void 0?!1:K;var t,a;return g.L(function(r){switch(r.L){case 1:if(!W.V.qy())return r.return([]);t=[];g.cf(r,2);return g.O(r,eRv(e,l,K),4);case 4:t=r.K;g.hm(r,3);break;case 2:g.oG(r);case 3:return a=FM2(W,t,l,"musicPlaylist"),r.return(a)}})},gMt=function(){g.b3.apply(this,arguments);
var W=this;this.events=new g.DF(this);this.OT=this.player.U();this.Xi={oY1:function(){return W.L},
Fb:function(){return W.Fb()},
uQ:function(e){return W.uQ(e)}}},pt_=function(W){var e;
W=g.f((e=W.getWatchNextResponse())==null?void 0:e.currentVideoEndpoint,g.mj);if(W==null?0:W.playlistId)var l=W.playlistId;return l},VX_=function(W,e){var l,K,t,a;
return g.L(function(r){if(r.L==1){l=e.clientPlaybackNonce;K={cpn:l,offlineSourceVisualElement:g.h8(e.Hx||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};e.K&&(K.videoFmt=Number(e.K.itag));e.J&&(K.audioFmt=Number(e.J.itag));if((t=pt_(e))&&e.videoId){var b=e.videoId;b=t!=="PPSV"?Promise.resolve(!1):W.L.mF(b);r=g.O(r,b,3)}else r=r.lq(2);return r}r.L!=2&&(a=r.K)&&(K.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");W.K=l;g.bL("offlinePlaybackStarted",K);g.uC(r)})};
g.pg.prototype.L6=g.bC(51,function(W){return this.app.L6(W)});
g.Ui.prototype.L6=g.bC(50,function(W){return g.WUf(this,9,W)});
g.R(DR,LE);g.$W.Object.defineProperties(DR.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.L.entityMetadata},
set:function(W){this.L.entityMetadata=W}}});
g.R(Syx,DR);Syx.prototype.K=function(){return[]};
g.R(Bk2,DR);Bk2.prototype.K=function(){return[]};
g.R(hG2,DR);hG2.prototype.K=function(){return[]};
g.R(oNK,DR);oNK.prototype.K=function(){return[]};
g.R(gNx,DR);gNx.prototype.K=function(){var W=[];this.L.alternateChannel&&W.push(this.L.alternateChannel);this.L.alternateChannelList&&W.push.apply(W,g.B(this.L.alternateChannelList));this.L.oneofChannelEntity&&W.push(this.L.oneofChannelEntity);return[].concat(g.B(new Set(W)))};
g.R(pCp,DR);pCp.prototype.K=function(){var W=[];this.L.entryCollection&&W.push(this.L.entryCollection);return[].concat(g.B(new Set(W)))};
g.R(VyU,LE);VyU.prototype.K=function(){var W=[];this.L.video&&W.push(this.L.video);return[].concat(g.B(new Set(W)))};
g.R(sS2,DR);sS2.prototype.K=function(){var W=[];this.L.parentPlaylist&&W.push(this.L.parentPlaylist);if(this.L.entries)for(var e=g.u(this.L.entries),l=e.next();!l.done;l=e.next())W.push.apply(W,g.B((new VyU(l.value)).K()));return[].concat(g.B(new Set(W)))};
g.R(ZAK,DR);ZAK.prototype.K=function(){var W=[];this.L.descriptionEntity&&W.push(this.L.descriptionEntity);this.L.creators&&W.push.apply(W,g.B(this.L.creators));this.L.theBiggestFan&&W.push(this.L.theBiggestFan);return[].concat(g.B(new Set(W)))};
g.R(FZk,DR);FZk.prototype.K=function(){return[]};
g.R(YyK,DR);YyK.prototype.K=function(){return[]};
g.R(OAJ,DR);OAJ.prototype.K=function(){return[]};
g.R(Aix,DR);Aix.prototype.K=function(){return[]};
g.R(LZp,DR);LZp.prototype.K=function(){return[]};
g.R(DRv,DR);DRv.prototype.K=function(){return[]};
g.R(vNC,DR);vNC.prototype.K=function(){return[]};
g.R(Jiv,DR);Jiv.prototype.K=function(){return[]};
g.R(ENt,DR);ENt.prototype.K=function(){return[]};
g.R(HAC,DR);HAC.prototype.K=function(){var W=[];this.L.downloadsList&&W.push(this.L.downloadsList);this.L.smartDownloadsList&&W.push(this.L.smartDownloadsList);this.L.recommendedDownloadsList&&W.push(this.L.recommendedDownloadsList);this.L.refresh&&W.push(this.L.refresh);return[].concat(g.B(new Set(W)))};
g.R(Pcx,LE);Pcx.prototype.K=function(){var W=[];this.L.video&&W.push(this.L.video);this.L.playlist&&W.push(this.L.playlist);this.L.videoItem&&W.push(this.L.videoItem);this.L.playlistItem&&W.push(this.L.playlistItem);return[].concat(g.B(new Set(W)))};
g.R(qyJ,DR);qyJ.prototype.K=function(){var W=[];this.L.refresh&&W.push(this.L.refresh);if(this.L.downloads)for(var e=g.u(this.L.downloads),l=e.next();!l.done;l=e.next())W.push.apply(W,g.B((new Pcx(l.value)).K()));return[].concat(g.B(new Set(W)))};
g.R(frn,DR);frn.prototype.K=function(){var W=[];this.L.localImageEntities&&W.push.apply(W,g.B(this.L.localImageEntities));return[].concat(g.B(new Set(W)))};
g.R(G1s,DR);G1s.prototype.K=function(){var W=[];this.L.playbackData&&W.push(this.L.playbackData);this.L.localImageEntities&&W.push.apply(W,g.B(this.L.localImageEntities));this.L.videoDownloadContextEntity&&W.push(this.L.videoDownloadContextEntity);return[].concat(g.B(new Set(W)))};
g.R(Tk2,DR);Tk2.prototype.K=function(){return[]};
g.R(xRs,DR);xRs.prototype.K=function(){var W=[];this.L.fakeChildren&&W.push.apply(W,g.B(this.L.fakeChildren));return[].concat(g.B(new Set(W)))};
g.R(Irp,DR);Irp.prototype.K=function(){var W=[];this.L.video&&W.push(this.L.video);this.L.playbackData&&W.push(this.L.playbackData);this.L.offlineVideoPolicy&&W.push(this.L.offlineVideoPolicy);return[].concat(g.B(new Set(W)))};
g.R(yiC,DR);yiC.prototype.K=function(){return[]};
g.R(nN_,DR);nN_.prototype.K=function(){var W=[];this.L.channelOwner&&W.push(this.L.channelOwner);this.L.videos&&W.push.apply(W,g.B(this.L.videos));this.L.collaboratorChannels&&W.push.apply(W,g.B(this.L.collaboratorChannels));this.L.downloadState&&W.push(this.L.downloadState);this.L.refresh&&W.push(this.L.refresh);return[].concat(g.B(new Set(W)))};
g.R(zGv,DR);zGv.prototype.K=function(){var W=[];this.L.video&&W.push(this.L.video);this.L.channelContributor&&W.push(this.L.channelContributor);return[].concat(g.B(new Set(W)))};
g.R(mRx,LE);mRx.prototype.K=function(){var W=[];this.L.localImageEntities&&W.push.apply(W,g.B(this.L.localImageEntities));this.L.videoDownloadContextEntity&&W.push(this.L.videoDownloadContextEntity);return[].concat(g.B(new Set(W)))};
g.R(XCs,LE);XCs.prototype.K=function(){var W=[];this.L.recommendedVideoMetadata&&W.push.apply(W,g.B((new mRx(this.L.recommendedVideoMetadata)).K()));return[].concat(g.B(new Set(W)))};
g.R(WDn,LE);WDn.prototype.K=function(){var W=[];this.L.playbackPosition&&W.push(this.L.playbackPosition);return[].concat(g.B(new Set(W)))};
g.R(jv3,DR);jv3.prototype.K=function(){var W=[];this.L.owner&&W.push(this.L.owner);this.L.downloadState&&W.push(this.L.downloadState);this.L.userState&&W.push.apply(W,g.B((new WDn(this.L.userState)).K()));this.L.additionalMetadata&&W.push.apply(W,g.B((new XCs(this.L.additionalMetadata)).K()));return[].concat(g.B(new Set(W)))};
g.R(eK3,DR);eK3.prototype.K=function(){var W=[];this.L.userChannelDetails&&W.push(this.L.userChannelDetails);return[].concat(g.B(new Set(W)))};
g.R(lp_,DR);lp_.prototype.K=function(){var W=[];this.L.channelOwner&&W.push(this.L.channelOwner);this.L.playbackPosition&&W.push(this.L.playbackPosition);this.L.localImageEntities&&W.push.apply(W,g.B(this.L.localImageEntities));this.L.downloadStatus&&W.push(this.L.downloadStatus);return[].concat(g.B(new Set(W)))};
g.R(iqC,DR);iqC.prototype.K=function(){return[]};
g.R(KDk,DR);KDk.prototype.K=function(){return[]};
g.R(tm3,DR);tm3.prototype.K=function(){return[]};
g.R(apt,DR);apt.prototype.K=function(){return[]};
g.R(rox,DR);rox.prototype.K=function(){return[]};
g.R(k_z,DR);k_z.prototype.K=function(){return[]};
g.R(bqU,DR);bqU.prototype.K=function(){return[]};
g.R($qU,DR);$qU.prototype.K=function(){return[]};
g.R(Mmn,DR);Mmn.prototype.K=function(){return[]};
g.R(wWJ,DR);wWJ.prototype.K=function(){return[]};
g.R(Uqz,DR);Uqz.prototype.K=function(){return[]};
g.R(Coz,DR);Coz.prototype.K=function(){var W=[];this.L.trackDownloadMetadatas&&W.push.apply(W,g.B(this.L.trackDownloadMetadatas));return[].concat(g.B(new Set(W)))};
g.R(Qvz,DR);
Qvz.prototype.K=function(){var W=[];this.L.downloadedTracks&&W.push.apply(W,g.B(this.L.downloadedTracks));this.L.smartDownloadedTracks&&W.push.apply(W,g.B(this.L.smartDownloadedTracks));this.L.downloadedEpisodes&&W.push.apply(W,g.B(this.L.downloadedEpisodes));this.L.downloadedAlbumReleases&&W.push.apply(W,g.B(this.L.downloadedAlbumReleases));this.L.smartDownloadedAlbumReleases&&W.push.apply(W,g.B(this.L.smartDownloadedAlbumReleases));this.L.downloadedPlaylists&&W.push.apply(W,g.B(this.L.downloadedPlaylists));this.L.smartDownloadedPlaylists&&
W.push.apply(W,g.B(this.L.smartDownloadedPlaylists));this.L.metadataOnlyTracks&&W.push.apply(W,g.B(this.L.metadataOnlyTracks));return[].concat(g.B(new Set(W)))};
g.R(dqC,DR);dqC.prototype.K=function(){var W=[];this.L.trackDownloadMetadatas&&W.push.apply(W,g.B(this.L.trackDownloadMetadatas));return[].concat(g.B(new Set(W)))};
g.R(N4K,DR);N4K.prototype.K=function(){var W=[];this.L.playbackData&&W.push(this.L.playbackData);this.L.localImageEntities&&W.push.apply(W,g.B(this.L.localImageEntities));this.L.videoDownloadContextEntity&&W.push(this.L.videoDownloadContextEntity);return[].concat(g.B(new Set(W)))};
g.R(RK2,DR);RK2.prototype.K=function(){var W=[];this.L.musicLibraryStatusEntity&&W.push(this.L.musicLibraryStatusEntity);this.L.primaryArtists&&W.push.apply(W,g.B(this.L.primaryArtists));this.L.details&&W.push(this.L.details);this.L.userDetails&&W.push(this.L.userDetails);this.L.tracks&&W.push.apply(W,g.B(this.L.tracks));this.L.share&&W.push(this.L.share);this.L.downloadMetadata&&W.push(this.L.downloadMetadata);this.L.refresh&&W.push(this.L.refresh);return[].concat(g.B(new Set(W)))};
g.R(ukK,DR);ukK.prototype.K=function(){var W=[];this.L.albumRelease&&W.push(this.L.albumRelease);this.L.tracks&&W.push.apply(W,g.B(this.L.tracks));return[].concat(g.B(new Set(W)))};
g.R(cov,DR);cov.prototype.K=function(){var W=[];this.L.albumRelease&&W.push(this.L.albumRelease);return[].concat(g.B(new Set(W)))};
g.R(SUn,DR);SUn.prototype.K=function(){var W=[];this.L.details&&W.push(this.L.details);this.L.userDetails&&W.push(this.L.userDetails);return[].concat(g.B(new Set(W)))};
g.R(B4U,DR);B4U.prototype.K=function(){var W=[];this.L.parentArtist&&W.push(this.L.parentArtist);return[].concat(g.B(new Set(W)))};
g.R(hKx,DR);hKx.prototype.K=function(){var W=[];this.L.parentArtist&&W.push(this.L.parentArtist);return[].concat(g.B(new Set(W)))};
g.R(ok_,DR);ok_.prototype.K=function(){return[]};
g.R(gk3,DR);gk3.prototype.K=function(){return[]};
g.R(pW3,LE);pW3.prototype.K=function(){var W=[];this.L.creatorEntity&&W.push(this.L.creatorEntity);return[].concat(g.B(new Set(W)))};
g.R(VmC,DR);
VmC.prototype.K=function(){var W=[];this.L.tracks&&W.push.apply(W,g.B(this.L.tracks));this.L.refresh&&W.push(this.L.refresh);this.L.musicLibraryStatusEntity&&W.push(this.L.musicLibraryStatusEntity);this.L.details&&W.push(this.L.details);this.L.downloadMetadata&&W.push(this.L.downloadMetadata);this.L.sideloadMetadata&&W.push(this.L.sideloadMetadata);this.L.userDetails&&W.push(this.L.userDetails);this.L.entryCollection&&W.push(this.L.entryCollection);this.L.share&&W.push(this.L.share);this.L.podcastShowAdditionalMetadata&&W.push.apply(W,
g.B((new pW3(this.L.podcastShowAdditionalMetadata)).K()));return[].concat(g.B(new Set(W)))};
g.R(sv_,DR);sv_.prototype.K=function(){return[]};
g.R(Zqs,DR);
Zqs.prototype.K=function(){var W=[];this.L.musicLibraryStatusEntity&&W.push(this.L.musicLibraryStatusEntity);this.L.artists&&W.push.apply(W,g.B(this.L.artists));this.L.audioModeVersion&&W.push(this.L.audioModeVersion);this.L.videoModeVersion&&W.push(this.L.videoModeVersion);this.L.userDetails&&W.push(this.L.userDetails);this.L.details&&W.push(this.L.details);this.L.albumRelease&&W.push(this.L.albumRelease);this.L.share&&W.push(this.L.share);this.L.libraryEdit&&W.push(this.L.libraryEdit);this.L.downloadMetadata&&
W.push(this.L.downloadMetadata);this.L.playbackPosition&&W.push(this.L.playbackPosition);this.L.lyrics&&W.push(this.L.lyrics);return[].concat(g.B(new Set(W)))};
g.R(FDp,DR);FDp.prototype.K=function(){var W=[];this.L.parentTrack&&W.push(this.L.parentTrack);return[].concat(g.B(new Set(W)))};
g.R(YUJ,DR);YUJ.prototype.K=function(){var W=[];this.L.parentTrack&&W.push(this.L.parentTrack);return[].concat(g.B(new Set(W)))};
g.R(Oqt,DR);Oqt.prototype.K=function(){return[]};
g.R(AoC,DR);AoC.prototype.K=function(){return[]};
g.R(LDv,DR);LDv.prototype.K=function(){return[]};
g.R(Dqn,DR);Dqn.prototype.K=function(){return[]};
g.R(vk2,DR);vk2.prototype.K=function(){var W=[];this.L.transfer&&W.push(this.L.transfer);this.L.adsPlaybackData&&W.push.apply(W,g.B(this.L.adsPlaybackData));this.L.drmLicense&&W.push(this.L.drmLicense);this.L.offlineVideoPolicy&&W.push(this.L.offlineVideoPolicy);this.L.videoDownloadContextEntity&&W.push(this.L.videoDownloadContextEntity);return[].concat(g.B(new Set(W)))};
g.R(Jok,DR);Jok.prototype.K=function(){return[]};
g.R(EkC,DR);EkC.prototype.K=function(){var W=[];this.L.offlineVideoStreams&&W.push.apply(W,g.B(this.L.offlineVideoStreams));this.L.captionTrack&&W.push.apply(W,g.B(this.L.captionTrack));return[].concat(g.B(new Set(W)))};
g.R(HqK,DR);HqK.prototype.K=function(){return[]};
g.R(PoK,DR);PoK.prototype.K=function(){return[]};
g.R(qUt,DR);qUt.prototype.K=function(){return[]};
g.R(fpz,DR);fpz.prototype.K=function(){return[]};
g.R(G_x,DR);G_x.prototype.K=function(){return[]};
g.R(T4_,DR);T4_.prototype.K=function(){return[]};
g.R(xqz,DR);xqz.prototype.K=function(){return[]};
g.R(Ipn,DR);Ipn.prototype.K=function(){return[]};
g.R(yoC,DR);yoC.prototype.K=function(){return[]};
g.R(nkx,DR);nkx.prototype.K=function(){return[]};
g.R(zKp,DR);zKp.prototype.K=function(){return[]};
g.R(mq_,DR);mq_.prototype.K=function(){return[]};
g.R(XWJ,DR);XWJ.prototype.K=function(){return[]};
g.R(Wpt,DR);Wpt.prototype.K=function(){return[]};
g.R(j1z,DR);j1z.prototype.K=function(){return[]};
g.R(eTK,DR);eTK.prototype.K=function(){return[]};
g.R(lmU,DR);lmU.prototype.K=function(){return[]};
g.R(ilz,DR);ilz.prototype.K=function(){return[]};
g.R(Kpz,DR);Kpz.prototype.K=function(){return[]};
g.R(t5K,DR);t5K.prototype.K=function(){return[]};
var l$U=["browse","music/browse","unplugged/browse"],rwn=["offline/playlist_sync_check"],IO2=["offline"],iRv=["offline/offline_video_playback_position_sync"],tV3=["offline/get_playback_data_entity"],v5;JT.getInstance=function(){return g.L(function(W){return W.return(new Promise(function(e){g.XY().then(function(l){l?(JT.instance||(JT.instance=new JT(l)),e(JT.instance)):e(void 0)})}))})};
JT.prototype.get=function(W){var e=this,l,K,t;return g.L(function(a){if(a.L==1)return g.O(a,blv(e.token),2);if(a.L!=3)return l=a.K,g.O(a,l.get("prefs",W),3);K=a.K;if(!K)return a.return();t=(0,g.VU)();return K.expirationTimestampMs<=t?a.return():a.return(K.value)})};
JT.prototype.set=function(W,e,l){l=l===void 0?31536E3:l;var K=this,t,a,r;return g.L(function(b){if(b.L==1)return t=(0,g.VU)(),a={key:W,value:e,expirationTimestampMs:t+l*1E3},g.O(b,blv(K.token),2);r=b.K;return g.O(b,g.AQ(r,"prefs",a),0)})};
JT.prototype.remove=function(W){var e=this,l;return g.L(function(K){if(K.L==1)return g.O(K,blv(e.token),2);l=K.K;return g.O(K,l.delete("prefs",W),0)})};
g.R(ET,g.I$);g.R(H5,C2k);H5.prototype.X=function(W,e){e=d4K(e);W=(new TextEncoder).encode(JSON.stringify(W));return this.L.encrypt(W,e)};
H5.prototype.K=function(W,e){if(!(W instanceof Uint8Array))throw $4K(1);var l=new TextDecoder;e=d4K(e);W=this.L.decrypt(W,e);return JSON.parse(l.decode(W))};
var Nc3={accountLinkStatusEntity:OAJ,booleanEntity:hG2,buttonEntity:XWJ,captionTrack:Oqt,channelHandle:Syx,commerceAcquisitionClientPayloadEntity:j1z,commerceCartListEntity:eTK,contextNoteFeedEntityPayload:Bk2,continuationTokenEntity:yiC,downloadQualityPickerEntity:vNC,downloadsPageRefreshTokenEntity:ENt,downloadsPageViewConfigurationEntity:iqC,downloadStatusEntity:Jiv,dismissState:xqz,sfvAudioItemCurrentlyPlayingEntity:fpz,emojiFountainDataEntity:zKp,emojiCustomizationSetEntity:nkx,fakeChannel:gNx,
fakePlaylist:pCp,fakePlaylistEntryCollection:sS2,fakeVideo:ZAK,fakeVideoDescription:FZk,featuredProductsEntity:Mmn,flowStateEntity:YyK,iconBadgeEntity:lmU,interstitialInteractionStateEntity:LZp,likeButtonAnimationEntity:KDk,liveChatPollStateEntity:DRv,liveViewerLeaderboardChatEntryPointStateEntity:PoK,liveViewerLeaderboardPointsEntity:qUt,liveReactionsDataEntity:mq_,logoEntity:Aix,macroMarkerEntity:tm3,mainDownloadsLibraryEntity:HAC,mainDownloadsListEntity:qyJ,mainPlaylistDownloadStateEntity:frn,
mainPlaylistEntity:nN_,mainPlaylistVideoEntity:zGv,mainVideoDownloadStateEntity:G1s,mainVideoEntity:jv3,markersEngagementPanelSyncEntity:apt,markersVisibilityOverrideEntity:rox,musicAlbumReleaseDetail:ukK,musicAlbumReleaseDownloadMetadataEntity:Coz,musicAlbumRelease:RK2,musicAlbumReleaseUserDetail:cov,musicArtistDetail:B4U,musicArtist:SUn,musicArtistUserDetail:hKx,musicDownloadsLibraryEntity:Qvz,musicLibraryEdit:ok_,musicLibraryStatusEntity:gk3,musicPlaylist:VmC,musicPlaylistDownloadMetadataEntity:dqC,
musicShare:sv_,musicTrackDetail:FDp,musicTrackDownloadMetadataEntity:N4K,musicTrack:Zqs,musicTrackUserDetail:YUJ,offlineOrchestrationActionWrapperEntity:AoC,offlineVideoPolicy:LDv,offlineVideoStreams:Dqn,offlineabilityEntity:Tk2,orchestrationWebSamplingEntity:xRs,pageHeaderEntity:Ipn,pdpStateEntity:ilz,pinnedProductEntity:wWJ,playbackData:vk2,playerStateEntity:k_z,quantityIncrementerEntity:Kpz,refresh:Jok,saveToPlaylistListEntity:G_x,settingEntity:T4_,stringEntity:oNK,suggestedFeedbackChipStateEntity:bqU,
transfer:EkC,trendingOfferEntity:Uqz,videoDownloadContextEntity:HqK,videoOverviewAsyncDataEntity:t5K,videoPlaybackPositionEntity:Wpt,votingEntity:yoC,ytMainChannelEntity:eK3,youchatPendingResponseEntity:$qU,ytMainDownloadedVideoEntity:Irp,ytMainVideoEntity:lp_};g.R(xO,C2k);xO.prototype.X=function(W){return W};
xO.prototype.K=function(W){if(W instanceof Uint8Array)throw $4K(0);return W};
g.R(Is,g.H);Is.prototype.observe=function(W){var e=this;this.observers.push(W);return function(){var l=e.observers.indexOf(W);l>=0&&e.observers.splice(l,1)}};
Is.prototype.K=function(W){Yd2(this,W.data)};
Is.prototype.JS=function(){this.channel.close()};
var vLs,OP_=new g.g8("elementsCommand");var B3=new g.g8("entityBatchUpdate");var cfn=new g.g8("downloadStatusEntity");var v0k=new g.g8("mainPlaylistEntityActionMetadata");var nd=new g.g8("mainVideoEntityActionMetadata");var xl3=new g.g8("musicPlaylistEntityActionMetadata");var N8v=new g.g8("musicTrackEntityActionMetadata");var XuJ=new g.g8("localImageEntityActionMetadata");var Ld=new g.g8("playbackDataActionMetadata");var AwU=new g.g8("transferEntityActionMetadata");var RRx=new g.g8("videoPlaybackPositionEntityActionMetadata");var XMz;new g.gr;new g.gr;iPs.prototype.request=function(W,e,l){e=e===void 0?{}:e;return this.locks.request(W,e,function(K){return l(K)})};var er=g.Hf.caches,jr,k8K;W3.prototype.open=function(W){return er.open(aOk(W))};
W3.prototype.has=function(W){return er.has(aOk(W))};
W3.prototype.delete=function(W){return er.delete(aOk(W))};
W3.prototype.match=function(W,e){var l=this,K,t,a,r,b,M;return g.L(function(w){switch(w.L){case 1:return g.O(w,l.keys(),2);case 2:K=w.K,t=g.u(K),a=t.next();case 3:if(a.done){w.lq(5);break}r=a.value;return g.O(w,l.open(r),6);case 6:return b=w.K,g.O(w,b.match(W,e),7);case 7:if(M=w.K)return w.return(M);a=t.next();w.lq(3);break;case 5:return w.return()}})};
g.R(tD3,W3);tD3.prototype.keys=function(){var W,e,l,K,t,a,r,b,M;return g.L(function(w){if(w.L==1)return W=[],e=g.yN("CacheStorage keys"),g.O(w,er.keys(),2);l=w.K;K=g.u(l);for(t=K.next();!t.done;t=K.next()){a=t.value;var U=a.indexOf(":");r=U===-1?{kM:a}:{kM:a.substring(0,U),datasyncId:a.substring(U+1)};b=r.kM;M=r.datasyncId;M===e&&W.push(b)}return w.return(W)})};g.R(iQ,g.H);iQ.prototype.X=function(W){this.api.hS("onOfflineOperationFailure",W.data)};
iQ.prototype.J=function(W){this.api.publish("offlinetransferpause",W.data)};
iQ.prototype.JS=function(){var W;(W=this.L)==null||W.close();var e;(e=this.K)==null||e.close()};MDJ.prototype.uy=function(){this.L&&t_(this)};
MDJ.prototype.Sa=function(){this.K&&this.K.resolve();this.X=this.L=!1;this.T()};var zR_=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var ZPJ="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var PPk="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.R(bR2,Y4);bR2.prototype.K=function(W){return bQ(W)?wTt(this,W):$4(W)?QPs(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};g.R(dzz,Y4);dzz.prototype.K=function(W){return $4(W)?NO_(this,W):ucn(W)?uVx(this,W):Mm(W)?cwv(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};g.k=SE2.prototype;g.k.UBT=function(W){var e=this,l,K,t,a;return g.L(function(r){if(!g.I(W.state,128))return r.lq(0);l=W.state.LH;var b=(K=l)==null?void 0:K.errorCode,M=(t=l)==null?void 0:t.wB;a=b==="net.connect"&&M===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(b==null?0:b.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.O(r,e.S$(e.player.getVideoData().videoId,a),0)})};
g.k.S$=function(W,e){var l=this;return g.L(function(K){if(K.L==1){if(l.K)return K.return();l.K=!0;return e==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(J_(l,W,!1,!0),K.lq(0)):g.O(K,v3(l,W),3)}g.ZK(W,4);return g.O(K,l.L.S$(e),0)})};
g.k.oT=function(W){W.status===2?(W.status!==this.X&&(NwJ(this.L),g.ZK(W.videoId,2)),W.P7&&Bwn(this.L,W.videoId,W.P7)):W.status===4?(v3(this,W.videoId),this.S$(W.videoId,W.e2?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):W.status===1&&SY2(this.L);this.X=W.status;this.api.hS("localmediachange",{videoId:W.videoId,status:W.status})};
g.k.QI=function(){var W=this,e;return g.L(function(l){if(l.L==1){if(W.K)return l.return();W.K=!0;e=W.player.getVideoData().videoId;return g.O(l,v3(W,e),2)}return g.O(l,W.L.QI(),0)})};
g.k.GA=function(W){switch(W){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.k.W=function(W){return this.api.U().W(W)};g.R(sP_,Y4);sP_.prototype.K=function(W){return bQ(W)?F8U(this,W):$4(W)?YEJ(this,W):ucn(W)?ORU(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};EAn.prototype.L=function(W,e){var l=W.action.actionMetadata.priority-e.action.actionMetadata.priority;l===0&&(W.L<e.L?l=-1:W.L>e.L&&(l=1));return l};g.R(Ew,g.H);Ew.prototype.JS=function(){this.T&&this.T();g.H.prototype.JS.call(this)};
Ew.prototype.createAction=function(W,e){var l=g.ny(W.entityKey).entityType,K=g.h2(16);return new dL(l,K,W,e.actionId,e.rootActionId)};
Ew.prototype.ET=function(W){var e=this,l,K,t,a,r,b,M,w,U;return g.L(function(C){if(C.L==1){if(e.qg())return C.return();K=(l=W.offlineOrchestrationActionWrapperEntity)!=null?l:new Set;t=[];a=g.u(K);for(r=a.next();!r.done;r=a.next())b=r.value,M=g.ny(b),w=M.entityId,qEt(e.L,w)||t.push(b);return g.O(C,WMv(e,t),2)}U=C.K;return g.O(C,XT_(e,U),0)})};
Ew.prototype.retry=function(){var W=this;return g.L(function(e){return g.O(e,j3x(W),0)})};liv.prototype.zf=function(W,e){e=e===void 0?!0:e;var l=this,K,t,a,r,b,M,w,U;return g.L(function(C){switch(C.L){case 1:if(!l.L)return C.return();K=[];t=g.mS(l.L.K,e);a=[];for(r={mM:0};r.mM<t.length;r={mM:r.mM},r.mM++)b=t[r.mM],M=l.L.KD(b,"json3"),w=g.sr(M,{withCredentials:!0,format:"RAW"},3,500).then(function(Q){return function(d){d={metadata:g.CT(t[Q.mM]),trackData:d.xhr.responseText};a.push(d)}}(r)).Xo(function(Q){lQ("Caption fetch error",Q)}),K.push(w);
return g.O(C,ciU(K),2);case 2:return g.cf(C,3),g.O(C,Tcz(W,a),5);case 5:g.hm(C,0);break;case 3:U=g.oG(C),lQ("Caption DB transaction error",U),g.uC(C)}})};g.R(H3,g.H);H3.prototype.JS=function(){this.K&&this.K();g.H.prototype.JS.call(this)};
H3.prototype.X=function(W){var e=this,l,K,t,a,r,b,M,w;return g.L(function(U){K=(l=W.transfer)!=null?l:new Set;t=[];a=g.u(K);for(r=a.next();!r.done;r=a.next())b=r.value,M=g.ny(b),w=M.entityId,t.push(w);return t.length===0?U.return():g.O(U,tdJ(e,t),0)})};g.R($6K,g.H);g.k=$6K.prototype;g.k.JS=function(){this.Zm&&this.Zm();this.Rr.dispose();this.J.dispose();this.Wx&&g.zg(this.V.DL,this.Wx);this.Bx&&g.zg(this.V.DL,this.Bx);g.H.prototype.JS.call(this)};
g.k.LsN=function(W){var e=this,l,K,t;return g.L(function(a){switch(a.L){case 1:l=g.zo(W,"transfer");if(e.L&&l===e.L.key){J_(e.B,e.C,!0);e.J.stop();a.lq(0);break}return g.O(a,yo(e.K,{mode:"readwrite",Gw:!0},function(r){return P5(r,l,"transfer").then(function(b){if(b&&b.transferState!=="TRANSFER_STATE_COMPLETE"&&b.transferState!=="TRANSFER_STATE_FAILED")return b.transferState="TRANSFER_STATE_PAUSED_BY_USER",Ga(r,b,"transfer").then(function(){return b})})}),3);
case 3:K=a.K;if(!K){a.lq(0);break}if(!W||!e.X){a.lq(5);break}return g.O(a,wL(W,e.X,e.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.O(a,fd(e,W),7);case 7:t=a.K,NCC({videoId:W,le:K,offlineModeType:t}),g.uC(a)}})};
g.k.Ow2=function(){var W=this;if(this.L&&this.C){J_(this.B,this.C,!1);var e=this.L,l=(e==null?0:e.key)?g.ny(e.key).entityId:"";l&&this.X&&(new Promise(function(K,t){wL(l,W.X,W.K,"DOWNLOAD_STATE_PAUSED").catch(function(a){t(a)})})).catch(function(K){lQ("Download state setting error",K)})}this.J.stop()};
g.k.E9=function(){this.L?U6n(this,this.L):qm(this)};
g.k.H5=function(W){var e=this;return g.L(function(l){switch(l.L){case 1:if(!e.L){l.lq(2);break}if(e.L.transferState==="TRANSFER_STATE_COMPLETE"||e.L.transferState==="TRANSFER_STATE_FAILED"||!W.transfer||!W.transfer.has(e.L.key)){l.lq(3);break}return g.O(l,za(e.K,e.L.key,"transfer"),4);case 4:e.L=l.K;if(e.L){l.lq(3);break}return g.O(l,CT2(e),3);case 3:if(e.L)return l.return();case 2:return g.O(l,qm(e),0)}})};
g.k.S$=function(W,e){var l=this,K,t,a,r,b;return g.L(function(M){switch(M.L){case 1:if(!l.L){G2(l,"onTransferFailure: "+W);M.lq(2);break}K=l.L;a=((t=K)==null?0:t.key)?g.ny(K.key).entityId:"";a:switch(W){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var w=!1;break a;default:w=!0}return w&&h5J(l)?g.O(M,T2(l,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.O(M,
o0z(l,W),5);case 5:if(!a||!l.X){M.lq(2);break}return g.O(M,wL(a,l.X,l.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.O(M,fd(l,a),9);case 9:r=M.K;rL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:a,le:K,offlineModeType:r});if(!a||!l.X){M.lq(2);break}return g.O(M,wL(a,l.X,l.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:P3(l),b=qm(l,!0),e&&e(b),g.uC(M)}})};
g.k.QI=function(W){var e=this,l,K,t,a,r,b,M,w,U,C,Q,d;return g.L(function(N){switch(N.L){case 1:if(!e.L){G2(e,"onMaybeTransferStreamsExpired");N.lq(2);break}return h5J(e)?g.O(N,T2(e,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.O(N,o0z(e,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!e.X){N.lq(2);break}l=e.L;t=((K=l)==null?0:K.key)?g.ny(l.key).entityId:"";if(!t){N.lq(2);break}return g.O(N,wL(t,e.X,e.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return e.L||G2(e,"onMaybeTransferStreamsExpiredRetryAttempting"),
a=e.L,b=((r=a)==null?0:r.key)?g.ny(a.key).entityId:"",g.O(N,fd(e,b),10);case 10:return M=N.K,rL({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:b,le:a,offlineModeType:M}),w=hu2(),g.PR(w,Ld,{isEnqueuedForExpiredStreamUrlRefetch:!0}),U=g.zo(b,"playbackData"),C={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:U,actionMetadata:w},Q=RI(new dL("playbackData",b,C)),g.O(N,nE(e.K,Q,"offlineOrchestrationActionWrapperEntity"),2);case 2:P3(e),d=qm(e,!0),
W&&W(d),g.uC(N)}})};
var s__={},g0K=(s__.TRANSFER_STATE_TRANSFERRING=1,s__.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,s__);g.k=x4.prototype;g.k.FQ=function(){return this.C.promise};
g.k.ev=function(){if(this.K&&this.B)return this.C.promise;s3C(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.k.jp=function(W){var e={};return e.playbackData=new bR2(W,this.OT,this.L),e.transfer=new sP_(W,this.OT),e.videoPlaybackPositionEntity=new dzz(W,this.OT),e};
g.k.XP=function(){var W=this;return g.L(function(e){return W.K?g.O(e,MdJ(W.K),0):e.lq(0)})};
g.k.fk=function(){var W=this,e,l;return g.L(function(K){if(K.L==1)return W.K||W.B?g.O(K,W.FQ(),2):K.return();W.N!==void 0&&(g.Nj(W.N),W.N=void 0);W.J!==void 0&&(g.Nj(W.J),W.J=void 0);(e=W.K)==null||e.dispose();W.K=void 0;(l=W.B)==null||l.dispose();W.B=void 0;W.api.hS("onOrchestrationLostLeader");W.C=new g.gr;g.uC(K)})};
g.k.isOrchestrationLeader=function(){return this.X.L};
g.k.mF=function(){return g.L(function(W){return W.return(!1)})};
g.k.Yp=function(W){var e=this.L;e.api.publish("offlinetransferpause",W);var l;(l=e.K)==null||l.postMessage(W)};
g.k.E9=function(W){var e,l;return g.L(function(K){if(K.L==1)return g.O(K,Xm(),2);e=K.K;if(!e)return K.return();l=g.zo(W,"transfer");return g.O(K,yo(e,{mode:"readwrite",Gw:!0},function(t){var a=P5(t,l,"transfer"),r=P5(t,g.zo(W,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.hQ.all([a,r]).then(function(b){b=g.u(b);var M=b.next().value;var w=b.next().value;return M&&M.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(M.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Ga(t,M,"transfer").then(function(){rL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:W,le:M,offlineModeType:w==null?void 0:w.offlineModeType});return g.hQ.resolve(null)})):g.hQ.resolve(null)})}),0)})};
g.k.Dh=function(W){W=W===void 0?43200:W;var e=this,l,K,t,a,r,b,M,w;return g.L(function(U){if(U.L==1)return e.V.qy()?g.O(U,Xm(),2):U.return(ZGv());if(U.L!=3){l=U.K;if(!l)return U.return([]);K=Date.now()/1E3;return g.O(U,mC(l,"offlineVideoPolicy"),3)}t=U.K;a=[];r=g.u(t);for(b=r.next();!b.done;b=r.next())M=b.value,Number(M.lastUpdatedTimestampSeconds)+W<=K&&(w=g.ny(M.key).entityId,a.push(w));return a.length?U.return(II(e,a,e.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):U.return([])})};
g.k.deleteAll=function(){return II(this,["!*$_ALL_ENTITIES_!*$"],this.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.k.refreshAllStaleEntities=function(W){var e=this;return g.L(function(l){return l.L==1?g.O(l,e.Dh(W),2):l.return(l.K)})};
g.k.setUpPositionSyncInterval=function(W){var e=this;this.J!==void 0&&(g.Nj(this.J),this.J=void 0);var l=W!=null?W:864E5;this.J=g.QR(function(){e.Lx(l)},l)};
g.k.Lx=function(W){var e=this,l,K,t,a,r,b;return g.L(function(M){switch(M.L){case 1:return g.cf(M,2),g.O(M,JT.getInstance(),4);case 4:l=M.K;if(!l)throw Error("prefStorage is undefined");return g.O(M,l.get("psi"),5);case 5:K=M.K;a=((t=K)==null?0:t.sL)?Number(K.sL)/1E3:0;r=Date.now();if(!(a+W<=r)){M.lq(6);break}return g.O(M,II(e,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.hm(M,0);break;case 2:b=g.oG(M),lQ("Offline manager error",b),
g.uC(M)}})};
g.k.AM=function(){var W=this,e,l,K,t,a,r,b;return g.L(function(M){if(M.L==1)return g.O(M,Xm(),2);if(M.L!=3)return(e=M.K)?g.O(M,mC(e,"transfer"),3):M.return([]);l=M.K;K=[];t=g.u(l);for(a=t.next();!a.done;a=t.next())r=a.value,r.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&r.key&&(b=g.ny(r.key).entityId,K.push(b));return M.return(YYx(W,K))})};
g.k.Rp=function(){return g.L(function(W){return W.return([])})};
g.k.sJ=function(){return g.L(function(W){g.uC(W)})};
g.k.Es=function(){return g.L(function(W){g.uC(W)})};g.R(OGt,Y4);OGt.prototype.K=function(W){return bQ(W)?D6t(this,W):$4(W)?Jcp(this,W):Mm(W)?E0K(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var yq=[10];g.R(Gq3,Y4);Gq3.prototype.K=function(W){return bQ(W)?Iip(this,W):$4(W)?yc_(this,W):Mm(W)?n0t(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var x62=[10];g.R(m62,Y4);m62.prototype.K=function(W){return $4(W)?Wfs(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};g.R(j_U,x4);g.k=j_U.prototype;g.k.jp=function(W){var e=x4.prototype.jp.call(this,W);e.mainVideoEntity=new Gq3(W,this.OT,this.L);e.mainPlaylistEntity=new OGt(W,this.OT,this.L);e.mainDownloadsListEntity=new m62(W,this.OT,this.L);return e};
g.k.refreshAllStaleEntities=function(W,e){var l=this,K,t,a,r,b,M,w,U,C,Q,d;return g.L(function(N){switch(N.L){case 1:K=[];if(!l.OT.W("web_player_offline_playlist_auto_refresh")){N.lq(2);break}return g.O(N,eqk(l,W,e),3);case 3:K=N.K;case 2:return g.O(N,JT.getInstance(),4);case 4:return t=N.K,g.O(N,(a=t)==null?void 0:a.get("sdois"),5);case 5:return r=N.K,g.O(N,(b=t)==null?void 0:b.get("lmqf"),6);case 6:M=N.K;if(!r){N.lq(7);break}U=K;C=U.concat;return g.O(N,lxJ(l,r,(w=M)!=null?w:"SD",W===0),8);case 8:K=
C.call(U,N.K);case 7:return Q=K,d=Q.concat,g.O(N,x4.prototype.refreshAllStaleEntities.call(l,W,e),9);case 9:return K=d.call(Q,N.K),N.return(K)}})};
g.k.mF=function(W){var e,l,K,t,a,r,b,M;return g.L(function(w){if(w.L==1)return g.O(w,Xm(),2);if(w.L!=3)return(e=w.K)?g.O(w,za(e,g.Z6,"mainDownloadsListEntity"),3):w.return(!1);l=w.K;if((K=l)==null?0:(t=K.downloads)==null?0:t.length)for(a=g.zo(W,"mainVideoEntity"),r=g.u(l.downloads),b=r.next();!b.done;b=r.next())if(M=b.value,M.videoItem===a)return w.return(!0);return w.return(!1)})};
g.k.Rp=function(){var W=this,e,l,K,t,a,r,b,M;return g.L(function(w){if(w.L==1)return g.O(w,Xm(),2);if(w.L!=3)return(e=w.K)?g.O(w,mC(e,"downloadStatusEntity"),3):w.return([]);l=w.K;K=[];t=g.u(l);for(a=t.next();!a.done;a=t.next())r=a.value,r.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&r.key&&(b=g.ny(r.key).entityId,K.push(b));return K.length?(M={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},w.return(II(W,K,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
M))):w.return([])})};
g.k.Es=function(){var W;return g.L(function(e){return e.L==1?g.O(e,Xm(),2):(W=e.K)?g.O(e,yo(W,{mode:"readwrite",Gw:!0},function(l){return qY(l,"mainVideoEntity").then(function(K){var t=[];K=g.u(K);for(var a=K.next();!a.done;a=K.next()){a=a.value;var r=void 0;(r=a.userState)!=null&&r.playbackPosition||(r=g.ny(a.key).entityId,r={key:g.zo(r,"videoPlaybackPositionEntity"),videoId:r,lastPlaybackPositionSeconds:"0"},t.push(Ga(l,r,"videoPlaybackPositionEntity")),a.userState={playbackPosition:r.key},t.push(Ga(l,
a,"mainVideoEntity")))}return g.hQ.all(t)})}),0):e.return()})};
g.k.sJ=function(){var W,e,l,K,t,a,r,b,M,w,U,C,Q,d,N,S,h,V,Y,A,v,q,X,y,iC,aG,Wf,G,m,c,T,Pf,on,dx,pH,jU,rx,NK;return g.L(function(p){if(p.L==1)return g.O(p,Xm(),2);if(p.L!=3){W=p.K;if(!W)return p.return();e=g.zo("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.O(p,yo(W,{mode:"readonly",Gw:!0},function(Z){return g.hQ.all([P5(Z,e,"mainDownloadsListEntity"),P5(Z,g.Z6,"mainDownloadsListEntity"),qY(Z,"mainVideoEntity"),qY(Z,"mainPlaylistEntity")])}),3)}l=p.K;
K=g.u(l);t=K.next().value;a=K.next().value;r=K.next().value;b=K.next().value;M=t;w=a;U=r;C=b;Q=new Set;if((d=M)==null?0:(N=d.downloads)==null?0:N.length)for(S=g.u(M.downloads),h=S.next();!h.done;h=S.next())V=h.value,Y=void 0,(A=(Y=V.videoItem)!=null?Y:V.playlistItem)&&Q.add(A);if((v=w)==null?0:(q=v.downloads)==null?0:q.length)for(X=g.u(w.downloads),y=X.next();!y.done;y=X.next())iC=y.value,iC.videoItem&&Q.add(iC.videoItem);aG=new Set;Wf=[];G=g.u(C);for(m=G.next();!m.done;m=G.next()){c=m.value;if(c.videos)for(T=
g.u(c.videos),Pf=T.next();!Pf.done;Pf=T.next())on=Pf.value,(dx=JSON.parse(g.ny(on).entityId).videoId)&&aG.add(dx);c.key&&!Q.has(c.key)&&Wf.push(c.key)}pH=g.u(U);for(jU=pH.next();!jU.done;jU=pH.next())rx=jU.value,rx.key&&!Q.has(rx.key)&&(NK=g.ny(rx.key).entityId,aG.has(NK)||Wf.push(rx.key));return Wf.length?g.O(p,v3z(W,Wf),0):p.lq(0)})};g.R(iit,Y4);iit.prototype.K=function(W){return bQ(W)?tXU(this,W):$4(W)?axJ(this,W):Mm(W)?rWs(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var z2=[10];g.R(biU,Y4);biU.prototype.K=function(W){return bQ(W)?MXs(this,W):$4(W)?wtp(this,W):Mm(W)?U5v(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var mW=[10];g.R(d52,Y4);d52.prototype.K=function(W){return bQ(W)?cWJ(this,W):$4(W)?S13(this,W):Mm(W)?B8K(this,W):Promise.reject(Error("Unsupported action type: "+W.actionType))};
var uTz=[10];g.R(X$,x4);X$.prototype.jp=function(W){var e=x4.prototype.jp.call(this,W);e.musicTrack=new d52(W,this.L);e.musicPlaylist=new biU(W,this.L);e.musicAlbumRelease=new iit(W,this.L);return e};
X$.prototype.refreshAllStaleEntities=function(W,e){var l=this,K,t,a;return g.L(function(r){if(r.L==1)return g.O(r,oMK(l,W,e),2);if(r.L!=3)return t=K=r.K,a=t.concat,g.O(r,x4.prototype.refreshAllStaleEntities.call(l,W,e),3);K=a.call(t,r.K);return r.return(K)})};g.R(gMt,g.b3);g.k=gMt.prototype;g.k.create=function(){var W=this;g.P(this,this.events);g.nn(this.OT)?this.L=new j_U(this.OT,this.player):g.vZ(this.OT)&&(this.L=new X$(this.OT,this.player));this.events.G(this.player,"onPlaybackStartExternal",function(){W.Fb()});
this.events.G(this.player,"videodatachange",function(){W.Fb()});
this.OT.W("html5_offline_playback_position_sync")&&this.events.G(this.player,"presentingplayerstatechange",this.uQ)};
g.k.HQ=function(){return!1};
g.k.ke=function(W,e,l,K){var t=this;return g.L(function(a){return t.L?a.return(II(t.L,W,e,l,K)):a.return(Promise.reject())})};
g.k.deleteAll=function(){return this.L.deleteAll()};
g.k.Dh=function(W){return this.L.Dh(W)};
g.k.refreshAllStaleEntities=function(W){return this.L.refreshAllStaleEntities(W)};
g.k.setUpPositionSyncInterval=function(W){this.L.setUpPositionSyncInterval(W)};
g.k.Yp=function(W){this.L.Yp(W)};
g.k.E9=function(W){return this.L.E9(W)};
g.k.Fb=function(){var W=this,e;return g.L(function(l){e=W.player.getVideoData();return g.z$(e)?pt_(e)&&W.K!==e.clientPlaybackNonce?g.O(l,VX_(W,e),0):l.lq(0):l.return()})};
g.k.uQ=function(W){var e=this,l,K,t,a,r,b,M;return g.L(function(w){if(w.L==1)return l=e.player.getVideoData(),K=l.jV,g.CX(W,2)||g.CX(W,512)?g.O(w,Xm(),2):w.return();if(w.L!=3){t=w.K;if(!t)return lQ("PES is undefined"),w.return();a=l.videoId;return g.O(w,za(t,g.zo(a,"mainVideoEntity"),"mainVideoEntity"),3)}r=w.K;if(!r)return w.return();b=Math.floor(K).toString();M={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:b}};return g.O(w,e.ke([a],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
M),0)})};
g.k.isOrchestrationLeader=function(){return this.L.isOrchestrationLeader()};
g.k.updateDownloadState=function(W,e){var l,K,t,a;return g.L(function(r){if(r.L==1)return g.O(r,Xm(),2);l=r.K;if(!l)return lQ("PES is undefined"),r.return();K=g.ny(W);t=K.entityType;a=K.entityId;return g.O(r,wL(a,t,l,e,!0),0)})};g.kt("offline",gMt);})(_yt_player);
